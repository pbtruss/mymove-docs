<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">Creating an Endpoint | MilMove Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/api/guides/guide-to-creating-an-endpoint"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Creating an Endpoint | MilMove Developer Portal"><meta data-react-helmet="true" name="description" content="These are the various steps that are involved in creating a new endpoint."><meta data-react-helmet="true" property="og:description" content="These are the various steps that are involved in creating a new endpoint."><link data-react-helmet="true" rel="shortcut icon" href="/mymove-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/api/guides/guide-to-creating-an-endpoint"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/api/guides/guide-to-creating-an-endpoint" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/api/guides/guide-to-creating-an-endpoint" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.03455fb1.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.4f028024.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.bdf6e75e.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/">Docs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/api">MilMove API</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Swagger Documentation</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Docs</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/api/guides/api-programming-guide">API Programming Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/api/guides/api-errors">API Errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/api/guides/api-style-guide">API Style Guide</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/api/guides/guide-to-creating-an-endpoint">Creating an Endpoint</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/api/guides/how-to-deprecate-endpoints">How to Deprecate an API Endpoint</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>Creating an Endpoint</h1></header><h6><a aria-hidden="true" tabindex="-1" class="anchor anchor__h6 anchorWithStickyNavbar_31ik" id="these-are-the-various-steps-that-are-involved-in-creating-a-new-endpoint"></a>These are the various steps that are involved in creating a new endpoint.<a class="hash-link" href="#these-are-the-various-steps-that-are-involved-in-creating-a-new-endpoint" title="Direct link to heading">#</a></h6><p>Prior to creating an endpoint in the Handler folder, we must first add a new endpoint definition to swagger. We are using Swagger 2.0, which is <a href="https://swagger.io/specification/v2/" target="_blank" rel="noopener noreferrer">OpenAPI</a>, a specification we use to format our RESTful APIs and provide a template for us to communicate the information in our API.
Always start with swagger. This step creates your endpoint definition and generates the files and helper functions you will need to create your endpoint. More specifically, swagger converts JSON user input into generated Go types.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="adding--a-new-entry-into-the-yaml"></a>Adding  a new entry into the yaml<a class="hash-link" href="#adding--a-new-entry-into-the-yaml" title="Direct link to heading">#</a></h2><p>All new definitions will be added in <code>mymove/swagger-def</code>. Note that we have broken down our spec into different files and we share definitions between files.
Built compiled versions of our API spec will be generated and stored in the swagger folder, which we will not edit directly. Notice that there is a yaml file for each of our APIs.
An endpoint definition for the prime will go into the Prime yaml, but you may notice there are some definitions in <code>mymove/swagger-def/definitions</code>.
This is because some definitions are shared across APIs and we&#x27;ve created a space to add those definitions in one place.
For example, <code>Uploads.yaml</code> shares its definition across various APIs, and rather than creating various yaml files for this action, we have created one and added it to the shared <code>definitions</code> folder.</p><p>For the purposes for adding a new endpoint, make sure that your endpoint is defined in these sections:</p><ul><li><code>tags</code> - is where we group all of our endpoints by category (i.e. shipment endpoints, agent endpoints, service item endpoints, etc.).
This top level field is where our gen files will divide the endpoints into their own packages. Tag component names are <code>camelCase</code>.</li><li><code>paths</code> - defines our endpoint. Path names use <code>kebab-case</code>.</li><li><code>definitions</code> - defines the shape of the data for our endpoint. Definitions component names are <code>PascalCase</code>.</li><li><code>responses</code> - define what the endpoints return. Responses component names are <code>PascalCase</code>.</li><li><code>parameters</code> - define what an endpoint needs (e.g. headers). Parameter component names are <code>camelCase</code>.</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="troubleshooting-your-local-swagger-state"></a>Troubleshooting your local swagger state:<a class="hash-link" href="#troubleshooting-your-local-swagger-state" title="Direct link to heading">#</a></h4><p>If you are having issues with your local swagger state it is recommended to run <code>make server_generate</code>, accept the prompt, and then run <code>make server_run</code> again. For more information on troubleshooting, <a href="https://ustcdp3.slack.com/archives/CP6PTUPQF/p1632254277386600" target="_blank" rel="noopener noreferrer">this</a> explanation will be helpful.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="defining-a-path-for-your-endpoint"></a>Defining a path for your endpoint<a class="hash-link" href="#defining-a-path-for-your-endpoint" title="Direct link to heading">#</a></h4><p>For more information about URL design and structure checkout: <a href="https://transcom.github.io/mymove-docs/docs/dev/contributing/backend/API-Style-Guide" target="_blank" rel="noopener noreferrer">API Style Guide</a></p><p>Defining your endpoint path follows this simple convention:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    /your path:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        HTTP request:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            summary: this is the name of the action your endpoint performs, in camelCase</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            description: new convention is to reference description files in the swagger-def/info/ folder</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            operationId: this should match the endpoint title in the definitions section and summary in your paths section.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            tags: matches the tag section for this endpoint</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            produces: this field will always be application/json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            parameters: include parameters associated with this path</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            responses: response codes for this path, and a schema reference and the description if needed.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>NOTE: The description item will reference markdown files in <code>swagger-def/info/</code>. This change is further described in a recent <a href="https://github.com/transcom/mymove/pull/7435" target="_blank" rel="noopener noreferrer">PR</a>.</p><p>An example of the <code>Moves</code> path is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  /moves:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    get:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      summary: listMoves</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      description:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          $ref: &#x27;info/{file_name}.md&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      operationId: listMoves</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      tags:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        - moveTaskOrder</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      produces:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        - application/json</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      parameters:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        - in: query</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          name: since</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          format: date-time</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          description: Only return moves updated since this time. Formatted like &quot;2021-07-23T18:30:47.116Z&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      responses:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;200&#x27;:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          description: Successfully retrieved moves. A successful fetch might still return zero moves.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          schema:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            $ref: &#x27;#/definitions/ListMoves&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;401&#x27;:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          $ref: &#x27;responses/PermissionDenied.yaml&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;403&#x27;:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          $ref: &#x27;responses/PermissionDenied.yaml&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        &#x27;500&#x27;:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          $ref: &#x27;#/responses/ServerError&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="description-section-and-the-response-body"></a>Description Section and the response body<a class="hash-link" href="#description-section-and-the-response-body" title="Direct link to heading">#</a></h4><p>In your endpoint description make sure that the following fields are included when necessary:</p><ul><li><code>required</code> - fields that are required are listed in the description section.</li><li><code>x-nullable</code> - this indicates that the value of a particular property may be
null. It will also return null if the value doesn&#x27;t exist otherwise it will be
omitted if x-nullable is false. <code>x-omitempty</code> -  this extension is good to add
and set it to false if we don&#x27;t want that field to be omitted if it is empty.</li><li><code>readOnly</code> - sometimes you will need specify a ready-only property, for
example when the property differs in a GET from a POST or PATCH. Note:
<code>readOnly</code> properties are included in responses but not in requests.</li><li><code>eTag</code> - An entity tag is provided so that a browser client or a script can
make conditional REST requests using optimistic concurrency control. All <code>eTags</code>
must be marked as <code>readOnly</code>.</li></ul><p>An example of the ListMove description is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">      ListMove:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        description:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            $ref: &#x27;info/{file_name}.md&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        type: object</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        properties:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          id:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            example: 1f2270c7-7166-40ae-981e-b200ebdf3054</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            format: uuid</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          moveCode:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            example: &#x27;HYXFJF&#x27;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            readOnly: true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          createdAt:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            format: date-time</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            readOnly: true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          orderID:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            example: c56a4180-65aa-42ec-a945-5fd21dec0538</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            format: uuid</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          referenceId:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            example: 1001-3456</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          availableToPrimeAt:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            format: date-time</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            x-nullable: true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            readOnly: true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          updatedAt:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            format: date-time</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            readOnly: true</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          ppmType:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            enum:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              - FULL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">              - PARTIAL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          ppmEstimatedWeight:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: integer</span></span><span class="token-line" style="color:#393A34"><span class="token plain">          eTag:</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            type: string</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            readOnly: true</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>For information on error responses, check out: <a href="https://transcom.github.io/mymove-docs/docs/dev/contributing/backend/API-Errors#api-errors" target="_blank" rel="noopener noreferrer">API Errors Guide</a></p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="gen-files"></a>Gen files:<a class="hash-link" href="#gen-files" title="Direct link to heading">#</a></h4><p>Once you finishing updating the yaml files with the new endpoint information make sure to run your make commands like <code>make swagger-generate</code> to autogenerate your swagger files, or simply run <code>make server_run</code>,
which runs your server and other useful make commands in one go.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="swagger-overview"></a>Swagger overview<a class="hash-link" href="#swagger-overview" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="swagger-architecture"></a>Swagger Architecture<a class="hash-link" href="#swagger-architecture" title="Direct link to heading">#</a></h3><p>Link to a pictorial view of how the Swagger packages map from <code>yaml</code> to <code>Go</code> files and functions. Highlighting <code>paths</code>,
<code>tags</code>, and <code>operationId</code>.</p><ul><li><a target="_blank" href="/mymove-docs/assets/files/SwaggerBackendArchitecture-04896085460566cade8544ee44ac5804.pdf">Link to PDF Swagger architecture</a></li></ul><p><img alt="MilMove Swagger architecture PNG" src="/mymove-docs/assets/images/SwaggerBackendArchitecture-425ee8547a389e6a13a868ad18499fb5.jpg"></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="example-diagram-of-how-swagger-calls-our-handler-functions"></a>Example diagram of how Swagger calls our handler functions:<a class="hash-link" href="#example-diagram-of-how-swagger-calls-our-handler-functions" title="Direct link to heading">#</a></h3><ul><li><a target="_blank" href="/mymove-docs/assets/files/MilMoveSwaggerCall-1ad30e9184211a690c310905ec498f27.pdf">Link to PDF MilMove Swagger call</a></li></ul><p><img alt="MilMove Swagger call PNG" src="/mymove-docs/assets/images/MilMoveSwaggerCall-b29c3058581367926ebd4b8d6ec8a63b.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="creating-a-handler"></a>Creating a Handler:<a class="hash-link" href="#creating-a-handler" title="Direct link to heading">#</a></h2><p>Now you&#x27;re ready to add your endpoint to the <code>handlers</code> folder. Start building out the service object before creating your handler.
For more information about service objects and when to create one: <a href="https://transcom.github.io/mymove-docs/docs/dev/contributing/backend/service-objects" target="_blank" rel="noopener noreferrer">Service Objects</a>.</p><p>An important note about service objects: The service layer is where we will store our business logic and connect to the database. Once a service object is created, it will be passed in to the handler <code>NewPrimeAPIHandler</code> function in <code>pkg/handlers/primeapi/api.go</code>,
and the handler will only be aware of the service object interface, while the service object will contain all of the rules and validations as well as accessing object from the database.</p><p>Handlers must never hit the database. Ideally, endpoint handlers are for type validations.</p><p>Handlers are also where we convert from payload (Swagger types) to model
(MilMove Go types). Generally, before calling the service object to process the
request, you would call the appropriate <code>payload_to_model.go</code> function. And
after returning from the call to the service object you would call the
appropriate <code>model_to_payload.go</code> function.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="steps-to-creating-a-new-handler"></a>Steps to creating a new handler:<a class="hash-link" href="#steps-to-creating-a-new-handler" title="Direct link to heading">#</a></h3><ol><li><strong>Add a handler for the endpoint.</strong><ul><li>Update the <code>api.go</code> file depending on which API you are updating:</li></ul></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pkg/handlers/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    adminapi/api.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcapi/api.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalapi/api.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ordersapi/api.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    primeapi/api.go</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    supportapi/api.go</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="2"><li><strong>Add payload_to_model converters</strong><ul><li>This is a good place to check data types and null values.</li><li>Each API has a set of <code>payload_to_model.go</code> and <code>model_to_paylaod.go</code> files under the <code>internal</code> dir:</li></ul></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pkg/handlers/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    adminapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ordersapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    primeapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    supportapi/internal/payloads</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li><strong>model_to_payload functions</strong><ul><li>Once we have either modified the model or added something to our model, it must be converted back into a payload in order to be returned by the handler.</li><li>Each API has a set of <code>payload_to_model.go</code> and <code>model_to_paylaod.go</code> files under the <code>internal</code> dir:</li></ul></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pkg/handlers/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    adminapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ordersapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    primeapi/internal/payloads</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    supportapi/internal/payloads</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="4"><li><strong>Create handler type and Handle function</strong><ul><li>Handlers are stored in this area depending on which API you are updating:</li></ul></li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pkg/handlers/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    adminapi/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ghcapi/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    internalapi/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ordersapi/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    primeapi/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    supportapi/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="5"><li><strong>Add tests for the handler</strong><ul><li>Add test code<div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> * Use `testdatagen` functions [[Understanding `Testdatagen` Functions]]</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div></li><li>Add mocks (only if absolutely necessary): <a href="https://transcom.github.io/mymove-docs/docs/dev/testing/writing-tests/generate-mocks-with-mockery" target="_blank" rel="noopener noreferrer">Generating Mocks with mockery</a></li></ul></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="anatomy-of-a-handler"></a>Anatomy of a handler<a class="hash-link" href="#anatomy-of-a-handler" title="Direct link to heading">#</a></h3><div class="admonition admonition-warning alert alert--danger"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="12" height="16" viewBox="0 0 12 16"><path fill-rule="evenodd" d="M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"></path></svg></span>warning</h5></div><div class="admonition-content"><p>This documentation is currently in transition while handlers are being
refactored to use <code>AuditableAppContextFromRequest</code> rather than extracting the
<code>AppContext</code> from the request.</p></div></div><p>All handlers should begin by storing the DB, logger, and/or session from the request into the <a href="/mymove-docs/docs/api/guides/use-stateless-services-with-app-context">AppContext</a>. This is the easiest way to get all three:</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Old way to get the AppContext</div><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">appCtx </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AppContextFromRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HTTPRequest</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">New way to get the AppContext</div><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">AuditableAppContextFromRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HTTPRequest</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">func</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> middleware</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Responder </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// contents of handler</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The new way of using the <code>appCtx</code> is to avoid some latent bugs where the
codebase was starting transactions but not running SQL inside of the
transaction due to referencing the incorrect <code>dbconnection</code>/<code>appCtx</code> from
&quot;outside&quot; the transaction. With the addition of
<code>AuditableAppContextFromRequest</code>, we now start a transaction and pass that into
handlers to ensure that all handlers are running inside a transaction.</p><p>This is done for multiple reasons, such as audit logging where we run
<code>RawQuery</code> to set local variables that contain the <code>userID</code> from the <code>appCtx</code>
Session.</p><p>And then this <code>appCtx</code> will be passed in as the first argument to any service object function. For example:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">shipment</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">RejectShipment</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> shipmentID</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> eTag</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> rejectionReason</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The DB, logger, and session can then be extracted from the app context like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">appCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DB</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">appCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Logger</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">appCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Below are other ways to grab the logger and session from the request, and populating the AppContext with them.</p><p>Grab just the logger:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">logger </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">LoggerFromRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HTTPRequest</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>or the session and logger:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> h</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">SessionAndLoggerFromRequest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HTTPRequest</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then, store the DB connection and logger in the
App Context:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">appCtx </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> appcontext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewAppContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DB</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you also need the session, you can do all three at once:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">appCtx </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> appcontext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">WithSession</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appcontext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewAppContext</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">DB</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> logger</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="validating-response-payload"></a>Validating Response Payload<a class="hash-link" href="#validating-response-payload" title="Direct link to heading">#</a></h3><p>We need to ensure that the data that is being returned from the
handler matches what is defined in the swagger definition.</p><p>In your tests you should call <code>Validate</code> on the payload.  Something
like ...</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    handler </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> ListMovesHandler</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">HandlerContext</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> context</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> MoveTaskOrderFetcher</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> movetaskorder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewMoveTaskOrderFetcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    response </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> handler</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Handle</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">params</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    suite</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsNotErrResponse</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    listMovesResponse </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">(</span><span class="token operator" style="color:#393A34">*</span><span class="token plain">movetaskorderops</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">ListMovesOK</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    movesList </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> listMovesResponse</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Payload</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic">// Validate the payload response</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    suite</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NoError</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">movesList</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Validate</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strfmt</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Default</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="authorization"></a>Authorization<a class="hash-link" href="#authorization" title="Direct link to heading">#</a></h3><p>You&#x27;ll notice that many handlers perform authorization within the handler, such as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsOfficeUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">||</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Roles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HasRole</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">roles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RoleTypeTOO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Only TOO role can reject shipments&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> shipmentops</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewRejectShipmentForbidden</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This duplicated logic can be extracted into a service object. Perhaps something like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">f </span><span class="token operator" style="color:#393A34">*</span><span class="token plain">authorization</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">TOOAuthorized</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token builtin">bool</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  session </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Session</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">IsOfficeUser</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> session</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Roles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">HasRole</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">roles</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">RoleTypeTOO</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>and then the handler would be updated like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">!</span><span class="token plain">h</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">TOOAuthorized</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  logger</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Error</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&quot;Only TOO role can reject shipments&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> shipmentops</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewRejectShipmentForbidden</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="connecting-the-handler-to-the-service-object"></a>Connecting the Handler to the Service Object:<a class="hash-link" href="#connecting-the-handler-to-the-service-object" title="Direct link to heading">#</a></h3><p>Once you create your handler type and Handle function, it can be added to <code>api.go</code>.
This file is also where you can connect your service object to the handler.
For example, our ListsMoves Handler will be passed the service object interface as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">primeAPI</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MoveTaskOrderListMovesHandler </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ListMovesHandler</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    ctx</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    movetaskorder</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">NewMoveTaskOrderFetcher</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Additionally in your file containing the handler make sure to pass in the services to your struct:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">type</span><span class="token plain"> ListMovesHandler </span><span class="token keyword" style="color:#00009f">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    handlers</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">HandlerContext</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    services</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">MoveTaskOrderFetcher</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="how-to-handle-errors"></a>How to handle errors<a class="hash-link" href="#how-to-handle-errors" title="Direct link to heading">#</a></h3><p>For more information on how we handle errors,  check out our detailed <a href="https://github.com/transcom/mymove-docs/blob/720592c63db4bffe402a801417f7c14772573c28/docs/dev/contributing/backend/API-Errors.md" target="_blank" rel="noopener noreferrer">documentation</a>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="add-event-key-and-update-event-map"></a>Add event key and update event map<a class="hash-link" href="#add-event-key-and-update-event-map" title="Direct link to heading">#</a></h3><p>Each API has a corresponding file in <code>/pkg/services/event/&lt;apiName&gt;_endpoint.go</code></p><ol><li>Add new <code>const</code> to represent event key</li><li>Add event key to endpoint map in the same file, using the event key name, api name, and operation ID.</li></ol><p>An example of an event key for MoveTaskOrder Create Handler is as follows:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic">// MoveTaskOrderCreateEventKey is a key containing MoveTaskOrder.Create</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> MoveTaskOrderCreateEventKey KeyType </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;MoveTaskOrder.Create&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The event would be added to the event map called eventModels:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> eventModels </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">map</span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">KeyType</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">eventModel</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    EndpointEventKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                    </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">EndpointEventKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// this is an example</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    NewEndpointEventKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">                 </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">NewEndpointEventKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Model</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token comment" style="color:#999988;font-style:italic">// this is an example</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    MoveTaskOrderCreateEventKey</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">         </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">MoveTaskOrderCreateEventKey</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> models</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Move</span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>If you&#x27;d like to learn more about event triggers, you can find more details <a href="https://github.com/transcom/mymove-docs/blob/720592c63db4bffe402a801417f7c14772573c28/docs/dev/contributing/backend/How-to-Add-an-Event-Trigger.md" target="_blank" rel="noopener noreferrer">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="references"></a>References:<a class="hash-link" href="#references" title="Direct link to heading">#</a></h2><ul><li><a href="/mymove-docs/docs/backend/testing/acceptance-testing-payment-requests">Acceptance testing payment requests</a></li><li><a href="/mymove-docs/docs/frontend/guides/access-swagger-endpoints-from-react">How To Call Swagger Endpoints from React</a></li><li><a href="/mymove-docs/docs/api/testing/acceptance-testing-prime-api-endpoints">Acceptance Testing Prime API</a></li><li><a href="/mymove-docs/docs/api/guides/how-to-deprecate-endpoints">How to Deprecate an API Endpoint</a></li><li><a href="/mymove-docs/docs/about/overview-of-milmove/#swagger">MilMove Overview Swagger section</a></li><li><a href="/mymove-docs/docs/api/testing/how-to-test-the-prime-api">How to Test the Prime API</a></li><li><a href="/mymove-docs/docs/api/guides/guide-to-creating-an-endpoint">Creating an Endpoint</a></li><li><a href="https://goswagger.io/tutorial/todo-list.html" target="_blank" rel="noopener noreferrer">Swagger tutorial</a></li></ul></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/api/guides/guide-to-creating-an-endpoint.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mymove-docs/docs/api/guides/api-style-guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« API Style Guide</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mymove-docs/docs/api/guides/how-to-deprecate-endpoints"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to Deprecate an API Endpoint Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#adding--a-new-entry-into-the-yaml" class="table-of-contents__link">Adding  a new entry into the yaml</a></li><li><a href="#swagger-overview" class="table-of-contents__link">Swagger overview</a><ul><li><a href="#swagger-architecture" class="table-of-contents__link">Swagger Architecture</a></li><li><a href="#example-diagram-of-how-swagger-calls-our-handler-functions" class="table-of-contents__link">Example diagram of how Swagger calls our handler functions:</a></li></ul></li><li><a href="#creating-a-handler" class="table-of-contents__link">Creating a Handler:</a><ul><li><a href="#steps-to-creating-a-new-handler" class="table-of-contents__link">Steps to creating a new handler:</a></li><li><a href="#anatomy-of-a-handler" class="table-of-contents__link">Anatomy of a handler</a></li><li><a href="#validating-response-payload" class="table-of-contents__link">Validating Response Payload</a></li><li><a href="#authorization" class="table-of-contents__link">Authorization</a></li><li><a href="#connecting-the-handler-to-the-service-object" class="table-of-contents__link">Connecting the Handler to the Service Object:</a></li><li><a href="#how-to-handle-errors" class="table-of-contents__link">How to handle errors</a></li><li><a href="#add-event-key-and-update-event-map" class="table-of-contents__link">Add event key and update event map</a></li></ul></li><li><a href="#references" class="table-of-contents__link">References:</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tutorial">Docusaurus Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2022  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.4f028024.js"></script>
<script src="/mymove-docs/assets/js/main.bdf6e75e.js"></script>
</body>
</html>