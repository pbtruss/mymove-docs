<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">How data will be imported into production | MilMove Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/backend/guides/ghc/ghc-import-pricing-production"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How data will be imported into production | MilMove Developer Portal"><meta data-react-helmet="true" name="description" content="References to bad links."><meta data-react-helmet="true" property="og:description" content="References to bad links."><link data-react-helmet="true" rel="shortcut icon" href="/mymove-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/backend/guides/ghc/ghc-import-pricing-production"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/ghc/ghc-import-pricing-production" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/ghc/ghc-import-pricing-production" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.2fa8fb56.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.c3833485.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.8b649ace.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/">Docs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/backend">MilMove Backend</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects">Backend Service Objects Development Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/backend-structure">Backend Structure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng_items-update-data">Adding ShipmentLineItem records to the 400ng table (tariff400ng_items)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/database">Database Guides</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/feature-flags-in-the-app">Feature flags in the app</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#" tabindex="0">Global Household Goods Contract</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-invoicing">GHC Rate Engine &amp; Invoicing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-rate-engine">GHC Rate Engine</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-invoicing-packages">GHC Invoicing Packages</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-invoicing-sequence-text">GHC Invoicing Sequence Text</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-pricing-parser">GHC Pricing Parser</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-pricing-import">How to run the GHC Pricing Import and Verify Data</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-transit-time-import">How to run the GHC Transit Time Import and Verify Data</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-import-pricing-production">How data will be imported into production</a></li></ul></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/guide-to-static-analysis-annotations-for-disabled-linters">Guide to Static Analysis Annotations for Disabled Linters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/guide-to-static-analysis-security-workflow">Guide to Static Analysis Security Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/access-global-variables">How to Access a Global Application Variable</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to guides</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-gex-connection">Troubleshoot GEX Connection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng-yearly-import">Importing tariff400ng data for the year</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-precommit-hook-failures">Precommit Hooks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/route-planner">Route Planner Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/session-management">Session management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/switching-over-to-nix">Switching over to Nix</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-time">Time in Golang</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-loops">Loop Iteration in Golang</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tspp-data-creation">Turning TDL scores and TSP discounts into transportation service provider performances</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/use-optimistic-locking">What Is Optimistic Locking?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/wip-server-side-validation">WIP server-side validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/zip-code-to-rate-area-mappings">Zip code to Rate area mappings</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/open-telemetry">Open Telemetry</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setup</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>How data will be imported into production</h1></header><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Fix broken links</h5></div><div class="admonition-content"><p>References to bad links.</p></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="problem"></a>Problem<a class="hash-link" href="#problem" title="Direct link to heading">#</a></h2><p><a href="https://dp3.atlassian.net/browse/MB-1287" target="_blank" rel="noopener noreferrer">JIRA MB-1287</a>
We currently have a way to parse and import pricing information for the local dev database, we now need a way to import
pricing information into the production environment.</p><p>While the <a href="https://dp3.atlassian.net/browse/MB-1287" target="_blank" rel="noopener noreferrer">story</a> as written emphasizes Solution 1 as a preferred solution  to achieve a production import, team infra
brought up a second option and accompanying considerations that should be weighed. Solution 2 will require some
collaboration and knowledge sharing about AWS infrastructure.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="proposed-solution-solution-1-create-a-secure-migration-script"></a>Proposed Solution (Solution 1: Create a Secure Migration Script)<a class="hash-link" href="#proposed-solution-solution-1-create-a-secure-migration-script" title="Direct link to heading">#</a></h2><p><strong>JIRA STORIES</strong></p><ul><li><a href="https://dp3.atlassian.net/browse/MB-2262" target="_blank" rel="noopener noreferrer">https://dp3.atlassian.net/browse/MB-2262</a></li><li><a href="https://dp3.atlassian.net/browse/MB-2300" target="_blank" rel="noopener noreferrer">https://dp3.atlassian.net/browse/MB-2300</a></li><li><a href="https://dp3.atlassian.net/browse/MB-2301" target="_blank" rel="noopener noreferrer">https://dp3.atlassian.net/browse/MB-2301</a></li></ul><p>We’ve decided to proceed with using the secure migration route to get data into production.</p><p>In addition, future stories are to be planned to plan on automating more of the process, and incorporating
recommendations around creating a ECS scheduled task as an alternative to running a secure migration:</p><ol><li>Versioning the table: we need a way to roll back the tables, potentially tied to the contract code of the upload.<ol><li>Write a design and research story to explore how we can version tables</li><li>Write a story for implementing the solution above</li></ol></li><li>Story to write and execute the scheduled task.</li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-1"></a>Step 1:<a class="hash-link" href="#step-1" title="Direct link to heading">#</a></h3><p>Create a Go script that runs a pg-dump and generates a secure migration</p><p>Create a pg_dump from a script</p><p>Include a command from within a script to dump the contents of the table for use
in the migration. This would be written in Go rather than in psql. How this
might look can be found in the following examples <a href="https://play.golang.org/p/YxoXuET1XK" target="_blank" rel="noopener noreferrer">Go
Playground</a> and <a href="https://stackoverflow.com/questions/57089144/write-file-from-exec-command" target="_blank" rel="noopener noreferrer">StackOverflow
Example</a></p><p>As reference the pg_dump in the terminal looks like:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">pg_dump -h localhost -U postgres -W dev_db -t re_* --data-only -T re_services* --data-only </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> table_name_dump.pgsql</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>It includes parameters to dump several tables (<code>-t -T</code>) , using a <a href="https://www.postgresql.org/docs/current/app-psql.html#APP-PSQL-PATTERNS" target="_blank" rel="noopener noreferrer">postgres pattern</a>
pointing to all tables that start with ‘re_’ and then exclude ‘re_services’, our solution written in Go should include these patterns.</p><p><strong>Pg_dump the golang way (include in the script)</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly go"><pre tabindex="0" class="prism-code language-go codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">cmd </span><span class="token operator" style="color:#393A34">:=</span><span class="token plain"> exec</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Command</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&quot;pg_dump&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    “</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">h”</span><span class="token operator" style="color:#393A34">+</span><span class="token plain">DbHost</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    “</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">U</span><span class="token string" style="color:#e3116c">&quot;+DbUserName,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    DbName,</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">)</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="display:inline-block;color:#e3116c">
</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">// Open the output file</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">outfile, err := os.Create(DbName + &quot;</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">gz&quot;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">defer</span><span class="token plain"> outfile</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Close</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Send stdout to the outfile. cmd.Stdout will take any io.Writer.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">cmd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">Stdout </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> outfile</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Start the command</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">If err cmd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Start</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Print</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">“Waiting </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> command to finish…”</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic">// Wait for the command to finish.</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">If err </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> cmd</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Wait</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"> err </span><span class="token operator" style="color:#393A34">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#36acaa">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    log</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">Fatal</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">err</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>Write script to generate a secure migration</strong></p><p>We’re following the route that involves writing a script, and we can model it after the following lines in the
<a href="https://github.com/transcom/mymove/blob/107872f9f6e7739f6b5d5efe988357b8fbe67192/cmd/milmove/gen_certs_migration.go#L199-L217" target="_blank" rel="noopener noreferrer">cac-migration script</a>.
From within the script, we will prompt the user to upload the migration to s3 as explained in <a href="https://github.com/transcom/mymove/blob/master/docs/database/migrate-the-database.md#creating-secure-migrations" target="_blank" rel="noopener noreferrer">step 8</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">log.Print(“Upload the migration to S3 with:upload-secure-migration &lt;production_migration_file&gt;”)</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>The command gets defined in <code>cmd/milmove/main.go</code> and list it
in <a href="https://github.com/transcom/mymove/blob/master/docs/database/migrate-the-database.md#creating-a-migration" target="_blank" rel="noopener noreferrer">Creating a Migration</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-2"></a>Step 2:<a class="hash-link" href="#step-2" title="Direct link to heading">#</a></h3><p>Run the pricing parser and spot check results. Generate the migration for production.</p><p><strong>Run Importer</strong></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly shell"><pre tabindex="0" class="prism-code language-shell codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> bin/ghc-pricing-parser</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> bin/ghc-pricing-parser</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> db_dev_reset db_dev_migrate</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ghc-pricing-parser --filename real_data_file_name.xlsx --contract-code TEST</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>After running the importer, verify the data <a href="https://github.com/transcom/mymove/blob/6f36e1fc63689c9852d8c6852340b4e61f4be6cf/docs/data/ghc-pricing-import.md#verifying-the-data" target="_blank" rel="noopener noreferrer">https://github.com/transcom/mymove/blob/6f36e1fc63689c9852d8c6852340b4e61f4be6cf/docs/data/ghc-pricing-import.md#verifying-the-data</a></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="step-3"></a>Step 3:<a class="hash-link" href="#step-3" title="Direct link to heading">#</a></h3><p>Run the script defined in step 1, first in Experimental then Production.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="solution-1-pros-and-cons"></a>Solution 1 Pros and Cons<a class="hash-link" href="#solution-1-pros-and-cons" title="Direct link to heading">#</a></h3><p><strong>Pros:</strong></p><ul><li>Handling human error: Developers on A-Team expressed concerns around solutions that put off identifying and addressing human errors that occur from the initial data import. For example, in the past developers have been able to catch missing and duplicate rows in spreadsheets received from USTC. Solutions that don’t put a human eye on the problem earlier in the process (i.e. during a local import) forego the opportunity to debug on the local level and push the problem solving to a more complicated space, production data.</li><li>The Presence of UUIDs is incredibly helpful: By running a secure migration, we can debug and resolve errors by targeting corrective migrations to the records that is the source of the problem. The most direct source of this information is the unique key: UUID that is visible to us locally. Because there is no visibility with production data, we wouldn’t be able to leverage this.</li><li>These migrations potentially will run so infrequently (&lt; 1x per year) maintaining this as a manual developer task would likely be the best route.</li></ul><p><strong>Cons:</strong></p><ul><li>A possible source of push back is the history of large migrations, and the persistence of inflated tables that past migrations attached to our production builds. Under the HHG system, tables of 1.5 million records were being created and slowed down production builds several orders of magnitude.</li><li>Secure migrations are not free, while this data isn’t as large as the 1.5 million records we imported in the past, It is still going to add to the download that slows production builds.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="other-options-considered"></a>Other Options Considered<a class="hash-link" href="#other-options-considered" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="solution-2-set-up-an-ecs-aws-scheduled-task"></a>Solution 2: Set up an ECS AWS Scheduled Task<a class="hash-link" href="#solution-2-set-up-an-ecs-aws-scheduled-task" title="Direct link to heading">#</a></h3><p>Build an ECS scheduled task that grabs XLSX data from S3 buckets, parses and
runs a pg-dump and loads it asynchronously into the DB. This should automate
many steps a developer would do by hand, and if designed well, can allow a
developer to spot check the results of the parser, run the task locally before
data makes it into the Production environment.</p><p><a href="https://github.com/transcom/mymove/blob/master/docs/how-to/create-an-ecs-scheduled-task.md#how-to-create-an-ecs-scheduled-task" target="_blank" rel="noopener noreferrer">How To Create a ECS Scheduled Task</a></p><p>A scheduled task runs daily, and turns off if there are no actions to take.
When the data changes (in our case for example, a new <code>xlsx</code> data set gets
uploaded) then the scheduled task should run. Our task is to design a way that
this process maintains debugging transparency and automation.</p><p>Thoughts: it’s supposedly not too difficult to automate some of the steps  and this path does allow for a human eye on the data before its moved into the production database</p><p><strong><code>cmd/milmove-tasks</code></strong>: This directory should house two tasks that will 1. Run
the GHC pricing parser, and possibly output a text file that displays the
results of the import 2. A task to connect and import the data into the
database.</p><p><strong>Makefile</strong>: where we’ll point to the scheduled tasks created in the
<code>cmd/milmove-tasks</code> directory. Make sure the target is named similar to the
scheduled task function you created.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="solution-2-pros-and-cons"></a>Solution 2 Pros and Cons<a class="hash-link" href="#solution-2-pros-and-cons" title="Direct link to heading">#</a></h4><p><strong>Pros:</strong></p><ul><li>Best option for avoiding the creation of enormous migrations that have historically caused production builds to take 10+ minutes</li><li>This option allows us to separate out some load so we aren’t adding data that devs are downloading for production migrations.</li></ul><p><strong>Cons:</strong></p><ul><li>We wont be able to use UUIDs to identify and target errors in the data import,
since UUIDs are not visible in production data, and they are regenerated for
all environments (prod UUIDs are different from dev-local or staging)</li><li>This solution will take extra work to be designed in a way that allows for
transparency around errors present in the <code>xlsx</code> imports, errors in the parser,
and anything that can cause a failed database import.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><ul><li><a href="https://docs.google.com/document/d/1QVwY5uobUpz87WEeAXSnIXG0NE1o4YnFW0Lf7PnMqO0/edit#" target="_blank" rel="noopener noreferrer">Original GDoc for this work</a>. This was quickly copied and leaving this here to double-check, if needed.</li></ul></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/backend/guides/ghc/ghc-import-pricing-production.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mymove-docs/docs/backend/guides/ghc/ghc-transit-time-import"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">« How to run the GHC Transit Time Import and Verify Data</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mymove-docs/docs/backend/guides/guide-to-static-analysis-annotations-for-disabled-linters"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Guide to Static Analysis Annotations for Disabled Linters »</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#problem" class="table-of-contents__link">Problem</a></li><li><a href="#proposed-solution-solution-1-create-a-secure-migration-script" class="table-of-contents__link">Proposed Solution (Solution 1: Create a Secure Migration Script)</a><ul><li><a href="#step-1" class="table-of-contents__link">Step 1:</a></li><li><a href="#step-2" class="table-of-contents__link">Step 2:</a></li><li><a href="#step-3" class="table-of-contents__link">Step 3:</a></li><li><a href="#solution-1-pros-and-cons" class="table-of-contents__link">Solution 1 Pros and Cons</a></li></ul></li><li><a href="#other-options-considered" class="table-of-contents__link">Other Options Considered</a><ul><li><a href="#solution-2-set-up-an-ecs-aws-scheduled-task" class="table-of-contents__link">Solution 2: Set up an ECS AWS Scheduled Task</a></li></ul></li><li><a href="#reference" class="table-of-contents__link">Reference</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tutorial">Docusaurus Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2022 United States Transportation Command. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.c3833485.js"></script>
<script src="/mymove-docs/assets/js/main.8b649ace.js"></script>
</body>
</html>