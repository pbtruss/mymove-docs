<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-backend/guides/service-validation">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.21">
<title data-rh="true">Validation in Service Objects | MilMove Developer Portal</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/backend/guides/service-validation"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Validation in Service Objects | MilMove Developer Portal"><meta data-rh="true" name="description" content="As covered in the Guide to Service Objects, service objects are designed to encapsulate MilMove&#x27;s business logic. This means that for mutation actions (POST, PUT, PATCH), we will have to thoroughly validate user input to ensure it complies with our business rules. To encourage development of minimal, modular functions to check each rule, we have developed a validation pattern that we can use consistently throughout our service objects. We have also designed it to easily change which rules are applied based on the kind of user performing the action."><meta data-rh="true" property="og:description" content="As covered in the Guide to Service Objects, service objects are designed to encapsulate MilMove&#x27;s business logic. This means that for mutation actions (POST, PUT, PATCH), we will have to thoroughly validate user input to ensure it complies with our business rules. To encourage development of minimal, modular functions to check each rule, we have developed a validation pattern that we can use consistently throughout our service objects. We have also designed it to easily change which rules are applied based on the kind of user performing the action."><link data-rh="true" rel="icon" href="/mymove-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/backend/guides/service-validation"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/service-validation" hreflang="en"><link data-rh="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/service-validation" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.2034d58b.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.9d78ed24.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.fe2e4d99.js" as="script">
</head>
<body class="navigation-with-keyboard" data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><div class="navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--light_HNdA"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_ToTc themedImage--dark_i4oU"></div><b class="navbar__title text--truncate">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/adrs">ADRs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="Switch between dark and light mode (currently light mode)" aria-label="Switch between dark and light mode (currently light mode)"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="searchBox_ZlJk"><div class="dsla-search-wrapper"><div class="dsla-search-field" data-tags="default,docs-default-current"></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docsWrapper_BCFX"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/mymove-docs/docs/backend">MilMove Backend</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/backend/testing/acceptance-testing-syncada-edi-invoicing">Testing</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/mymove-docs/docs/backend/guides/service-objects">Guides</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects">Backend Service Objects Development Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/backend-structure">Backend Structure</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng_items-update-data">Adding ShipmentLineItem records to the 400ng table (tariff400ng_items)</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/database">Database Guides</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/feature-flags-in-the-app">Feature flags in the app</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/ghc/ghc-invoicing">Global Household Goods Contract</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/guide-to-static-analysis-annotations-for-disabled-linters">Guide to Static Analysis Annotations for Disabled Linters</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/guide-to-static-analysis-security-workflow">Guide to Static Analysis Security Workflow</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/access-global-variables">How to Access a Global Application Variable</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/mymove-docs/docs/backend/guides/how-to/add-an-event-trigger">How-to guides</a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-gex-connection">Troubleshoot GEX Connection</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng-yearly-import">Importing tariff400ng data for the year</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-precommit-hook-failures">Precommit Hooks</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/route-planner">Route Planner Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/session-management">Session management</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/roles-and-permissions">Roles and Permissions</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/switching-over-to-nix">Switching over to Nix</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-time">Time in Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-loops">Loop Iteration in Golang</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tspp-data-creation">Turning TDL scores and TSP discounts into transportation service provider performances</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/use-optimistic-locking">What Is Optimistic Locking?</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/zip-code-to-rate-area-mappings">Zip code to Rate area mappings</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/wip-server-side-validation">WIP server-side validation</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/debugging-sql-tests">Debugging SQL Tests</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/open-telemetry">Open Telemetry</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-guide">Golang Programming Guide</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/backend/guides/service-validation">Validation in Service Objects</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/use-stateless-services-with-app-context">AppContext: how and when to use it</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/mymove-docs/docs/backend/setup/configure-postico-or-tableplus-to-connect-to-mymove-db">Setup</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_GujU"><div class="docItemContainer_Adtb"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/mymove-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_OVgt"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Guides</span><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Validation in Service Objects</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_aoJ5"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><h1>Validation in Service Objects</h1><p>As covered in the <a href="/mymove-docs/docs/backend/guides/service-objects">Guide to Service Objects</a>, service objects are designed to encapsulate MilMove&#x27;s business logic. This means that for mutation actions (POST, PUT, PATCH), we will have to thoroughly validate user input to ensure it complies with our business rules. To encourage development of minimal, modular functions to check each rule, we have developed a validation pattern that we can use consistently throughout our service objects. We have also designed it to easily change which rules are applied based on the kind of user performing the action.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="the-pattern">The Pattern<a class="hash-link" href="#the-pattern" title="Direct link to heading">​</a></h2><p>Below is an example of the sub-package structure for a typical service object:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">mymove/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">├── pkg/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   ├── services/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   ├── reweigh/ </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── reweigh_creator.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── reweigh_creator_test.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── reweigh_service_test.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   ├── ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>To implement the validation pattern, there are two key files we need to add: <code>validation.go</code> and <code>rules.go</code>:</p><div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token plain">mymove/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">├── pkg/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   ├── services/</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   ├── reweigh/ </span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── reweigh_creator.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── reweigh_creator_test.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── reweigh_service_test.go</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── rules.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── rules_test.go</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── validation.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   │   ├── validation_test.go</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">│   │   ├── ...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>The first file, <code>reweigh_creator.go</code>, contains the main functionality for our service. This is where we write the function that is exposed outside of the package through an interface. It is the entrypoint for the client.</p><p><code>validation.go</code> contains the machinery that executes our validation in this service. It is almost entirely functional, and will generally look similar in other packaged services. A lot of this code is boilerplate.</p><p><code>rules.go</code> contains our business logic. This is where we will write the functions that check each of our distinct business rules for the object. They should be able to be called independently of each other.</p><p>These three files are the foundation for this pattern. All we need are a function that performs a service, a function that executes validators, and (ideally) many functions that represent the rules for our validation. As business rules are added and removed, <code>reweigh_creator.go</code> and <code>validation.go</code> should not need to be changed (although there is always an exception to any rule).</p><p>Note that this pattern <strong>may not need to be implemented in every service</strong>. The services that involve considerable business logic and/or rules that change based on who the client is will benefit the most from the validation pattern.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="implementing-the-pattern">Implementing the Pattern<a class="hash-link" href="#implementing-the-pattern" title="Direct link to heading">​</a></h2><p>First things first, you&#x27;ll need to identify some of the business rules or utilities that you&#x27;d like to implement. Common checks will verify if the related move is available to the Prime contractor, if the ID/foreign key values on the base object have been manipulated, if circumstantially required fields have been filled out, and so on.</p><p>If you don&#x27;t know what business rules you&#x27;ll be working with, <strong>you won&#x27;t know whether or not you need to implement this pattern.</strong> Do not skip this step.</p><div class="admonition admonition-caution alert alert--warning"><div class="admonition-heading"><h5><span class="admonition-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></span>Advanced Golang</h5></div><div class="admonition-content"><p>The validation pattern documented here makes use of some advanced Go patterns. If you&#x27;re struggling with the syntax or would like more context on what is happening, here are some helpful resources:</p><ul><li><strong>Interfaces</strong><ul><li><a href="https://gobyexample.com/interfaces" target="_blank" rel="noopener noreferrer">Go by Example: Interfaces</a></li><li><a href="https://golangbot.com/interfaces-part-1/" target="_blank" rel="noopener noreferrer">Interfaces in Go</a></li></ul></li><li><strong>Function types</strong><ul><li><a href="https://stackoverflow.com/questions/9398739/working-with-function-types-in-go" target="_blank" rel="noopener noreferrer">Working with function types in Go</a></li><li><a href="https://yourbasic.org/golang/function-pointer-type-declaration/" target="_blank" rel="noopener noreferrer">Function types and values</a></li></ul></li><li><strong>Variadic functions</strong><ul><li><a href="https://gobyexample.com/variadic-functions" target="_blank" rel="noopener noreferrer">Go by Example: Variadic Functions</a></li><li><a href="https://golangbot.com/variadic-functions/" target="_blank" rel="noopener noreferrer">Variadic Functions</a></li><li><a href="https://www.digitalocean.com/community/tutorials/how-to-use-variadic-functions-in-go" target="_blank" rel="noopener noreferrer">How to use variadic functions in Go</a></li></ul></li><li><strong>Closures</strong><ul><li><a href="https://gobyexample.com/closures" target="_blank" rel="noopener noreferrer">Go by Example: Closures</a></li><li><a href="https://www.calhoun.io/5-useful-ways-to-use-closures-in-go/" target="_blank" rel="noopener noreferrer">5 useful ways to use closures in Go</a></li></ul></li></ul></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="validator-interface"><code>validator</code> interface<a class="hash-link" href="#validator-interface" title="Direct link to heading">​</a></h3><p>Create a <code>validation.go</code> file in your service object&#x27;s sub-package. This is where we&#x27;ll set up our validator types and write the base function that handles our validation. </p><p>For the first step, we&#x27;ll define an interface type that all of our validators will implement. This type will have one method, <code>Validate()</code>, and it will be private to our service package:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/validation.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> reweigh</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// validator describes a method for checking business requirements on a model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> validator </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token function" style="color:#79b6f2">Validate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Based on our general Go standards, we know this function (and all functions) will take in the <code>AppContext</code>. Since the action is &quot;validate,&quot; it also makes sense that it would return an error. But what else do we need?</p><p>The parameters of <code>Validate()</code> should include <strong>all of the model types</strong> that you will need to validate your business rules. This will change on a case-by-case basis, but, at a minimum, you will generally include your subject model type.</p><p>For our example, we know we have a <code>ReweighCreator</code> service, and we will also have a <code>ReweighUpdater</code> service. We need our <code>models.Reweigh</code> type for both of these cases as the base model to validate. </p><p>For the updater in particular, we will also need a model type that represents the &quot;delta&quot; of the action, the fields that were modified by the user. </p><p>A reweigh is also affected by the weight fields on the shipment itself, so that is another model type we will need for some validation.</p><p>Our fully defined interface is:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/validation.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> reweigh</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// validator describes a method for checking business requirements on a model</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> validator </span><span class="token keyword" style="color:#c5a5c5">interface</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// The base Reweigh is assumed to be required, so that is a value type. </span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// The delta and shipment parameters are optional, so they are pointer types.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token function" style="color:#79b6f2">Validate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We can also add the type that will implement this interface. This will be a function type and will enable use to write our rules using <a href="https://gobyexample.com/closures" target="_blank" rel="noopener noreferrer">closures</a>.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/validation.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// validatorFunc is an adapter type for converting a function into an implementation of validator</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> validatorFunc </span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// Validate fulfills the validator interface</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">fn validatorFunc</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">Validate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">fn</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Note that all of these function signatures are the exact same. <strong>They must stay the same</strong> so that these types implement the <code>validator</code> interface defined above. Such is the nature of interfaces types. It might feel inconvenient to repeat this signature over and over, but at least it forces us to be explicit about our input.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="validatemodel-function"><code>validateModel</code> function<a class="hash-link" href="#validatemodel-function" title="Direct link to heading">​</a></h3><p>The last thing we&#x27;re going to add to our <code>validation.go</code> for the time being is the <code>validateModel()</code> function (replace &quot;Model&quot; with the name of your service model). </p><p>This function will take in the necessary data, run through all of the validators we pass in, and return an error as appropriate. It will be called from our service object, meaning it is the primary access point for all of our validation. Our current pattern makes this private, but if any of our validator code was to be made public, this function would be it.</p><p>Our signature will look very similar to what we have above, but with the additional <code>checks</code> parameter:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/validation.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// validateReweigh checks a Reweigh against a passed-in set of business rules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validateReweigh</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    reweigh models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    delta </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    shipment </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token operator" style="color:#d7deea">...</span><span class="token plain">validator</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">result </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// no code yet</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This <code>checks</code> parameter is what is known as a &quot;variadic parameter,&quot; making this a <a href="https://gobyexample.com/variadic-functions" target="_blank" rel="noopener noreferrer">variadic function</a>. This allows us to pass in however many rules we want, granting us flexibility in how we validate services depending on who is using it.</p><p>Note that we also have a <strong>named return value</strong>, which allows us to reference the <code>result</code> variable as an error type without explicitly defining it. This is a neat little Go trick that helps us write more efficient code.</p><p>Now we can add the code to loop through our validators and call the <code>Validate()</code> method.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/validation.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">_</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> checker </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">range</span><span class="token plain"> checks </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> checker</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Validate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// error handling will go here</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>After we call <code>Validate()</code>, we must handle the error that comes back. We have a couple of guidelines for doing this:</p><ul><li>The <a href="https://pkg.go.dev/github.com/gobuffalo/validate" target="_blank" rel="noopener noreferrer">Go Buffalo type <code>validate.Errors</code></a> (commonly assigned to <code>verrs</code>) should be used to track input errors per field. We do this so the user can get as much information back as possible instead of only seeing one error per request.<ul><li>Use <code>Add(fieldName str, Message str)</code> to add individual errors to this type one-at-a-time.</li><li>Use <code>Append(verrs validate.Errors)</code> to combine lists of validation errors.</li></ul></li><li>All validation errors should be wrapped in a <code>services.InvalidInputError</code> type when returned from the service object.</li><li>Any other error types are not combined and take immediate precedence over input errors. For example, the error saying that the model should not have been visible to the caller will take precedence over an error about the phone number being mistyped. </li></ul><p>In order to follow these guidelines, we need to check the type of the error being returned from the validator. If the error is a validation error type, we will combine it with an ongoing list of validation errors and continue checking the rest of the validators. </p><p>If it is <em>not</em> a validation error, we stop everything and return it right away.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/validation.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">verrs </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> validate</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewErrors</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">_</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> checker </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">range</span><span class="token plain"> checks </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> checker</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Validate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">switch</span><span class="token plain"> e </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">case</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">validate</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Errors</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// Accumulate all validation errors</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Append</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">default</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// Non-validation errors have priority,</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// and short-circuit doing any further checks</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> err</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>If we finish checking all of our validators, and we haven&#x27;t run into any priority errors, we&#x27;ll need to check if we found any validation errors and wrap them in an <code>InvalidInputError</code>. This is the last step to complete our <code>validateReweigh</code> function.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/validation.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// validateReweigh checks a Reweigh against a passed-in set of business rules</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validateReweigh</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    reweigh models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    delta </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    shipment </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token operator" style="color:#d7deea">...</span><span class="token plain">validator</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">result </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    verrs </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> validate</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewErrors</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">for</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">_</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> checker </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">range</span><span class="token plain"> checks </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> checker</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Validate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">switch</span><span class="token plain"> e </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">type</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">case</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">validate</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Errors</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999">// Accumulate all validation errors</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Append</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">e</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">default</span><span class="token punctuation" style="color:#8dc891">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999">// Non-validation errors have priority,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token comment" style="color:#999999">// and short-circuit doing any further checks</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> err</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">HasAny</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        result </span><span class="token operator" style="color:#d7deea">=</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewInvalidInputError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">reweigh</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Invalid input found while validating the reweigh.&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> result</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>This function is almost entirely boilerplate - it can be copied and pasted from one service to another with minimal changes.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="rules-functions"><code>rules</code> functions<a class="hash-link" href="#rules-functions" title="Direct link to heading">​</a></h3><p>Create a <code>rules.go</code> file in your service object&#x27;s sub-package. You will need to use the types defined in <code>validation.go</code>, so make sure you complete that step first. </p><p>You will also need a list of business rules to implement - <strong>you didn&#x27;t skip that step, right?</strong></p><p>For our example, we will implement two different rules:</p><ul><li>Check that an ID value isn&#x27;t present when creating a reweigh. This can cause unexpected server errors if we don&#x27;t catch it.</li><li>Check if a reweigh is associated with a Prime-available move.</li></ul><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/rules.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">package</span><span class="token plain"> reweigh</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">import</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/appcontext&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token string" style="color:#8dc891">&quot;github.com/transcom/mymove/pkg/models&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// checkReweighID checks that the user can&#x27;t manually set the reweigh&#x27;s ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">checkReweighID</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> validator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatorFunc</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">//TODO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// checkPrimeAvailability checks that move associated with the reweigh is available to the Prime contractor</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">checkPrimeAvailability</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> validator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatorFunc</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">//TODO</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>These functions are <a href="https://gobyexample.com/closures" target="_blank" rel="noopener noreferrer"><strong>closures</strong></a>, which basically means a function within function. In this case, the outer function has no parameters and returns the <code>validator</code> interface type. </p><p>The <em>inner</em> function, however, must have a signature that is exactly the same as our <code>validatorFunc</code> function type so that we can use the interface. This means you will have to change all of these rule functions if you ever change that base signature, so keep that in mind as you continue working on validation.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="checkreweighid"><code>checkReweighID</code><a class="hash-link" href="#checkreweighid" title="Direct link to heading">​</a></h4><p>Let&#x27;s add the logic for our <code>checkReweighID</code> rule:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/rules.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// checkReweighID checks that the user can&#x27;t manually set the reweigh&#x27;s ID</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">checkReweighID</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> validator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatorFunc</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token boolean" style="color:#ff8b50">_</span><span class="token plain"> appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> delta </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">_</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        verrs </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> validate</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewErrors</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// If there is no delta, then we are creating a new reweigh:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> delta </span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> reweigh</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> uuid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Nil </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Add</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;ID&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;cannot manually set a new reweigh&#x27;s UUID&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> verrs</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Observe that on line 3, we use <code>_</code> to mark the input parameters that we don&#x27;t use in this rule (in this case, <code>appCtx</code> and <code>shipment</code>). Since we need a verbose signature to fit our needs for <em>all</em> of these rules, there is no way we&#x27;re going to use everything in every single rule. Use <code>_</code> to make clear what is relevant and what isn&#x27;t.</p><p>On line 4, we also initialize a <code>verrs</code> variable. This is so we can accumulate our invalid input errors. We always return this at the end of our rule function. An empty <code>verrs</code> instance will be ignored.</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="checkprimeavailability"><code>checkPrimeAvailability</code><a class="hash-link" href="#checkprimeavailability" title="Direct link to heading">​</a></h4><p>This one is a little different:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/rules.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// checkPrimeAvailability checks that move associated with the reweigh is available to the Prime contractor</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">checkPrimeAvailability</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">checker services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MoveTaskOrderChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> validator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validatorFunc</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">_</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> shipment </span><span class="token operator" style="color:#d7deea">==</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewNotFoundError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">newReweigh</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;while looking for Prime-available Shipment&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        isAvailable</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> checker</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">MTOAvailableToPrime</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MoveTaskOrderID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">!</span><span class="token plain">isAvailable </span><span class="token operator" style="color:#d7deea">||</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewNotFoundError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">                reweigh</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> fmt</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Sprintf</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;while looking for Prime-available Shipment with id: %s&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> shipment</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We pass in a parameter to the top function, <code>checkPrimeAvailability</code>! This is the true power of closures, and it&#x27;s cool because it means we were able to pass in a new parameter without changing the signature for all of the other rule functions. The parameter <code>checker</code> is a service that we need for this function in particular to validate the Prime-availability rule.</p><p><strong>So what goes in the validator signature and what goes in the input of the outer function?</strong></p><p>There is a lot of room for interpretation with this, but some general guidelines are:</p><ul><li>If it&#x27;s a dependency that can be set up before the service function is called, pass it in as the input of the outer function.</li><li>If it&#x27;s data that <em>must</em> be retrieved <em>during</em> the service function, it should be in the validator function signature. </li></ul><p>The parameters in the outer functions are like <em>dependencies</em>, and the validator function signature is the true input.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="grouping-rules-functions">Grouping <code>rules</code> functions<a class="hash-link" href="#grouping-rules-functions" title="Direct link to heading">​</a></h3><p>Once we have some rules, we&#x27;ll want to be able to group them according who called the service. The key here is to define functions that will return slices of validator functions, instead of constant slice variables.</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// basicChecks are the rules that should always run for reweigh validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">basicChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">validator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">validator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token function" style="color:#79b6f2">checkReweighID</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token comment" style="color:#999999">// primeChecks are the rules that should only run for validating Prime reweigh actions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">primeChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">checker services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MoveTaskOrderChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">validator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">validator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token function" style="color:#79b6f2">checkReweighID</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token function" style="color:#79b6f2">checkPrimeAvailability</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">checker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>It looks like we&#x27;re calling these functions now, which wouldn&#x27;t make sense because we don&#x27;t have all of the input. But remember: These are <em>closures</em>, so by calling the outer function, we&#x27;re getting another function that has not been called yet. The returned function is our validator. The validators won&#x27;t be called until the <code>validateReweigh()</code> function is executed.</p><p>Note that we <em>do</em> pass in whatever parameters we use in the outer functions at this level. This is where we set those &quot;dependencies.&quot;</p><p>These grouping functions can be used in multiple places, and are meant for utility. They are not a hard requirement to implement the validator pattern, but they are helpful organizational tools. </p><p>In general, you should always have a set of rules for &quot;basic&quot; validation, which is as bare as possible. You&#x27;ll build up more requirements as you go, so it&#x27;s better to err on the side of fewer checks to start with. You may place these group functions in the <code>validation.go</code> or the <code>rules,go</code> file - whichever makes more sense for your use case.</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="connecting-the-service">Connecting the service<a class="hash-link" href="#connecting-the-service" title="Direct link to heading">​</a></h3><p>Once you have finished creating the <code>validateModel</code> function and defining your rules, you are ready to connect your service object to the validation. First, go to your service object&#x27;s struct and add a field for the validators:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/reweigh_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token keyword" style="color:#c5a5c5">type</span><span class="token plain"> reweighCreator </span><span class="token keyword" style="color:#c5a5c5">struct</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    checks </span><span class="token punctuation" style="color:#8dc891">[</span><span class="token punctuation" style="color:#8dc891">]</span><span class="token plain">validator </span><span class="token comment" style="color:#999999">// a slice of validator functions</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Now we&#x27;re going to set the validators in the <code>New&lt;ServiceObject&gt;</code> function. To start with, we&#x27;ll set the basic set of checks:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/reweigh_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// NewReweighCreator creates a new struct with the service dependencies and returns the interface type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewReweighCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ReweighCreator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">reweighCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token function" style="color:#79b6f2">basicChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>We don&#x27;t allow the user to pass in the checks so that way we can dictate how our service is validated across the entire app. To allow the caller to use the Prime validator functions instead, we&#x27;ll make a new <code>New&lt;ServiceObject&gt;</code> function to handle it:</p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/reweigh_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// NewPrimeReweighCreator creates a new ReweighCreator with Prime-specific validation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">NewPrimeReweighCreator</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">checker services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MoveTaskOrderChecker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ReweighCreator </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">reweighCreator</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token function" style="color:#79b6f2">primeChecks</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">checker</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>Using this strategy, we can add however many <code>New&lt;Validation&gt;&lt;ServiceObject&gt;</code> functions as we need to. They will all return the same service interface with different validators. This way we don&#x27;t have to muddle with our interface definition, which is great because every modification to an interface has to be reproduced with every struct that implements that interface. Creating new initializer functions is the least invasive way to change up our validation.</p><p>Finally, we have to call the <code>validateModel</code> function in our service method: </p><div class="language-go codeBlockContainer_Ckt0 theme-code-block" style="--prism-background-color:#282c34;--prism-color:#ffffff"><div class="codeBlockTitle_Ktv7">./pkg/services/reweigh/reweigh_creator.go</div><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-go codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#ffffff"><span class="token comment" style="color:#999999">// CreateReweigh creates a new reweigh for a shipment. It is a method on the reweighCreator struct.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">f </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">reweighCreator</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">CreateReweigh</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">(</span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Set up an empty model to receive any data found by Pop</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    mtoShipment </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;</span><span class="token plain">models</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">MTOShipment</span><span class="token punctuation" style="color:#8dc891">{</span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Find the shipment using the ShipmentID provided in our reweigh input</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">Find</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">mtoShipment</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> reweigh</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ShipmentID</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Return our standard NotFoundError type if there&#x27;s an error</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewNotFoundError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">reweigh</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">ShipmentID</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;while looking for MTOShipment&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token comment" style="color:#999999">// Run the (read-only) validations</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> verr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> </span><span class="token function" style="color:#79b6f2">validateReweigh</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">appCtx</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">*</span><span class="token plain">reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> mtoShipment</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> f</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">checks</span><span class="token operator" style="color:#d7deea">...</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">;</span><span class="token plain"> verr </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> verr</span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    txErr </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> appCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewTransaction</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token keyword" style="color:#c5a5c5">func</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">txnCtx appcontext</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">AppContext</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token builtin" style="color:#D8DEE9">error</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">:=</span><span class="token plain"> txnCtx</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">DB</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">ValidateAndCreate</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">reweigh</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token comment" style="color:#999999">// Check for validation errors encountered before Pop created the reweigh</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> verrs </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token operator" style="color:#d7deea">&amp;&amp;</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">HasAny</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// Return our standard InvalidInputError type</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewInvalidInputError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token plain">uuid</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token plain">Nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> verrs</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;Invalid input found while creating the reweigh.&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">else</span><span class="token plain"> </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> err </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token comment" style="color:#999999">// If the error is something else (this is unexpected), we create a QueryError</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">            </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> services</span><span class="token punctuation" style="color:#8dc891">.</span><span class="token function" style="color:#79b6f2">NewQueryError</span><span class="token punctuation" style="color:#8dc891">(</span><span class="token string" style="color:#8dc891">&quot;Reweigh&quot;</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> err</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token string" style="color:#8dc891">&quot;&quot;</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token punctuation" style="color:#8dc891">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">if</span><span class="token plain"> txErr </span><span class="token operator" style="color:#d7deea">!=</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"> </span><span class="token punctuation" style="color:#8dc891">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">        </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> txErr</span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token punctuation" style="color:#8dc891">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain">    </span><span class="token keyword" style="color:#c5a5c5">return</span><span class="token plain"> reweigh</span><span class="token punctuation" style="color:#8dc891">,</span><span class="token plain"> </span><span class="token boolean" style="color:#ff8b50">nil</span><span class="token plain"></span><br></span><span class="token-line" style="color:#ffffff"><span class="token plain"></span><span class="token punctuation" style="color:#8dc891">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="Copy" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>And we&#x27;re done! Now it&#x27;s up to the caller to decide whether to use the base checks, the Prime checks, or to write new rules functions and create a different set of checks, if necessaary. </p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="testing-the-pattern">Testing the Pattern<a class="hash-link" href="#testing-the-pattern" title="Direct link to heading">​</a></h2><p>Testing the pattern is generally like testing any Go code (look at the tests for the <a href="#examples">linked examples</a> for more inspiration). However, here are some guidelines for what you should focus on for each part of the pattern:</p><ul><li>Testing rule functions (<code>rules_test.go</code>)<ul><li>Each one of these functions should be independent and modular, so creating test cases should be easiest to do at this level. Take advantage of this and write thorough unit tests for all the cases you can think of.</li></ul></li><li>Testing the validation utility code (<code>validation_test.go</code>)<ul><li>This code is generally boilerplate and extremely similar across service objects. An integration test or two is generally fine.</li></ul></li><li>Testing the service object (<code>&lt;service_action&gt;_test.go</code>)<ul><li>You should still be testing for every possible return value from this service object. When it comes to testing interactions with the validators, a few integration tests and/or some mocks should be sufficient.</li><li>You should have at least one test for each different version of the <code>New&lt;ServiceObject&gt;()</code> function you wrote. Make sure the correct checks are being used, but you do not need to thoroughly unit test each distinct test again (since that should be done in <code>rules_test.go</code>).</li></ul></li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="examples">Examples<a class="hash-link" href="#examples" title="Direct link to heading">​</a></h2><ul><li>Move Excess Weight Uploader<ul><li><a href="https://github.com/transcom/mymove/blob/master/pkg/services/move/excess_weight_uploader.go" target="_blank" rel="noopener noreferrer">https://github.com/transcom/mymove/blob/master/pkg/services/move/excess_weight_uploader.go</a></li><li><a href="https://github.com/transcom/mymove/blob/master/pkg/services/move/validation.go" target="_blank" rel="noopener noreferrer">https://github.com/transcom/mymove/blob/master/pkg/services/move/validation.go</a></li></ul></li><li>Reweighs<ul><li><a href="https://github.com/transcom/mymove/blob/master/pkg/services/reweigh/rules.go" target="_blank" rel="noopener noreferrer">https://github.com/transcom/mymove/blob/master/pkg/services/reweigh/rules.go</a></li><li><a href="https://github.com/transcom/mymove/blob/master/pkg/services/reweigh/validation.go" target="_blank" rel="noopener noreferrer">https://github.com/transcom/mymove/blob/master/pkg/services/reweigh/validation.go</a></li></ul></li><li><a href="https://github.com/transcom/mymove/blob/master/pkg/services/reweigh/validation.go" target="_blank" rel="noopener noreferrer">https://github.com/transcom/mymove/blob/master/pkg/services/reweigh/validation.go</a></li><li><a href="https://github.com/transcom/mymove/blob/master/pkg/services/mto_shipment/validation.go" target="_blank" rel="noopener noreferrer">https://github.com/transcom/mymove/blob/master/pkg/services/mto_shipment/validation.go</a></li></ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/backend/guides/service-validation.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_eYIM" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_vbeJ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/mymove-docs/docs/backend/guides/golang-guide"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Golang Programming Guide</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/mymove-docs/docs/backend/guides/use-stateless-services-with-app-context"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">AppContext: how and when to use it</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-pattern" class="table-of-contents__link toc-highlight">The Pattern</a></li><li><a href="#implementing-the-pattern" class="table-of-contents__link toc-highlight">Implementing the Pattern</a><ul><li><a href="#validator-interface" class="table-of-contents__link toc-highlight"><code>validator</code> interface</a></li><li><a href="#validatemodel-function" class="table-of-contents__link toc-highlight"><code>validateModel</code> function</a></li><li><a href="#rules-functions" class="table-of-contents__link toc-highlight"><code>rules</code> functions</a></li><li><a href="#grouping-rules-functions" class="table-of-contents__link toc-highlight">Grouping <code>rules</code> functions</a></li><li><a href="#connecting-the-service" class="table-of-contents__link toc-highlight">Connecting the service</a></li></ul></li><li><a href="#testing-the-pattern" class="table-of-contents__link toc-highlight">Testing the Pattern</a></li><li><a href="#examples" class="table-of-contents__link toc-highlight">Examples</a></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About MilMove</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/adrs">Architecture Decision Records</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item">MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li class="footer__item"><a href="https://6130eb5cde15830007fdf57b--docusaurus-2.netlify.app/docs" target="_blank" rel="noopener noreferrer" class="footer__link-item">Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_lCJq"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 2022  U.S. Federal Government (in countries where recognized) and TrussWorks. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.9d78ed24.js"></script>
<script src="/mymove-docs/assets/js/main.fe2e4d99.js"></script>
</body>
</html>