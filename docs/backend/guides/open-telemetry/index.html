<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">Open Telemetry | MilMove Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://transcom.github.io/mymove-docs/docs/backend/guides/open-telemetry"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="Open Telemetry | MilMove Developer Portal"><meta data-react-helmet="true" name="description" content="The Milmove app has had aspects of logging (Zap), tracing (trace middleware), and monitoring (AWS infra dashboards) previously, but there is now an ADR to use the Open Telemetry library to standardize our efforts. While not solely useful just for load testing, it did expose our need for better insight into the performance of the Milmove app and it&#x27;s services."><meta data-react-helmet="true" property="og:description" content="The Milmove app has had aspects of logging (Zap), tracing (trace middleware), and monitoring (AWS infra dashboards) previously, but there is now an ADR to use the Open Telemetry library to standardize our efforts. While not solely useful just for load testing, it did expose our need for better insight into the performance of the Milmove app and it&#x27;s services."><link data-react-helmet="true" rel="shortcut icon" href="/mymove-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://transcom.github.io/mymove-docs/docs/backend/guides/open-telemetry"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/open-telemetry" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs/docs/backend/guides/open-telemetry" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.2fa8fb56.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.1c4a4698.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.8b649ace.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">MilMove Documentation</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/frontend">Frontend</a><a class="navbar__item navbar__link navbar__link--active" href="/mymove-docs/docs/backend">Backend</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/api">API</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/tools">Tools</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/">Docs</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/index">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/backend">MilMove Backend</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Testing</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">Guides</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/service-objects">Backend Service Objects Development Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/backend-structure">Backend Structure</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng_items-update-data">Adding ShipmentLineItem records to the 400ng table (tariff400ng_items)</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/database">Database Guides</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/feature-flags-in-the-app">Feature flags in the app</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">Global Household Goods Contract</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/guide-to-static-analysis-annotations-for-disabled-linters">Guide to Static Analysis Annotations for Disabled Linters</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/guide-to-static-analysis-security-workflow">Guide to Static Analysis Security Workflow</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/access-global-variables">How to Access a Global Application Variable</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#" tabindex="0">How-to guides</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-gex-connection">Troubleshoot GEX Connection</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tariff400ng-yearly-import">Importing tariff400ng data for the year</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/troubleshoot-precommit-hook-failures">Precommit Hooks</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/route-planner">Route Planner Guide</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/session-management">Session management</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/switching-over-to-nix">Switching over to Nix</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-time">Time in Golang</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/golang-loops">Loop Iteration in Golang</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/tspp-data-creation">Turning TDL scores and TSP discounts into transportation service provider performances</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/use-optimistic-locking">What Is Optimistic Locking?</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/wip-server-side-validation">WIP server-side validation</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/backend/guides/zip-code-to-rate-area-mappings">Zip code to Rate area mappings</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/backend/guides/open-telemetry">Open Telemetry</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">Setup</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>Open Telemetry</h1></header><p>The Milmove app has had aspects of logging (Zap), tracing (trace middleware), and monitoring (AWS infra dashboards) previously, but there is now an <a href="https://github.com/transcom/mymove/blob/master/docs/adr/0061-use-opentelemetry-for-distributed-tracing.md" target="_blank" rel="noopener noreferrer">ADR to use the Open Telemetry library</a> to standardize our efforts. While not solely useful just for load testing, it did expose our need for better insight into the performance of the Milmove app and it&#x27;s services.</p><ul><li><a href="#implementation">Implementation</a><ul><li><a href="#environment-configuration">Environment configuration</a></li><li><a href="#go-package">Go package</a></li><li><a href="#instrumentation">Instrumentation</a></li></ul></li><li><a href="#data-collection">Data collection</a><ul><li><a href="#traces">Traces</a></li><li><a href="#metrics">Metrics</a></li><li><a href="#resources">Resources</a></li></ul></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="implementation"></a>Implementation<a class="hash-link" href="#implementation" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="environment-configuration"></a>Environment configuration<a class="hash-link" href="#environment-configuration" title="Direct link to heading">#</a></h3><p>Open Telemetry is configured like many of our features through environment variables.  When the application binary is started in <code>cmd/milmove/serve.go</code> the system reads if telemetry is enabled and also for which environment it is running in (locally or AWS/loadtesting).</p><p><strong>Telemetry environment variables:</strong></p><table><thead><tr><th>Environment variable</th><th>Default value</th><th>Notes</th></tr></thead><tbody><tr><td>TELEMETRY_ENABLED</td><td>false</td><td>Enables telemetry</td></tr><tr><td>TELEMETRY_ENDPOINT</td><td>&quot;stdout&quot;</td><td>Endoint for where to send traces and metrics, the default would be the console. An http and/or gprc endpoint <code>host:port</code> where exports are sent.</td></tr><tr><td>TELEMETRY_USE_XRAY_ID</td><td>false</td><td>When telemetry is used in a deployed AWS environment this needs to be set to true so that trace IDs are formatted properly. This way the same request can be correlated across the firewall WAF, Load Balancer, and ECS service if needed.</td></tr><tr><td>TELEMETRY_SAMPLING_FRACTION</td><td>.5</td><td>Recording every log would bog down the application so we only want to send a representative fraction of all logs.  When developing locally setting to <code>1</code> would mean every log is sent.</td></tr><tr><td>TELEMETRY_COLLECT_SECONDS</td><td>30</td><td>The interval in seconds between calls to collect metrics.</td></tr></tbody></table><p>When <a href="/mymove-docs/docs/tools/telemetry/running-telemetry-locally">running telemetry locally</a> with the open telemetry collector stack (defined in docker-compose.telemetry.yaml), the development configuration used is that of <code>config/telemetry/collector-config.dev.yaml</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="go-package"></a>Go package<a class="hash-link" href="#go-package" title="Direct link to heading">#</a></h3><p>The main initialization code for registering telemetry can be found in <code>pkg/telemetry/init.go</code></p><p>The custom code for collecting database connection stats also lives within the package at <code>pkg/telemetry/db.go</code>.</p><p>The code for hooking into the Go runtime library for memory stats lives within the package at <code>pkg/telemetry/runtime.go</code></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="instrumentation"></a>Instrumentation<a class="hash-link" href="#instrumentation" title="Direct link to heading">#</a></h3><p>The ecosystem of Open Telemetry comes with many built in and 3rd party libraries for plugging into our existing code with little or no customization.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="routing"></a>Routing<a class="hash-link" href="#routing" title="Direct link to heading">#</a></h4><p>Milmove uses the Gorilla mux router so we can use the existing <a href="https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation/github.com/gorilla/mux/otelmux" target="_blank" rel="noopener noreferrer">otelmux library</a> middleware for our non-swagger routes.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">router.Use(otelmux.Middleware(&quot;auth&quot;))</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="http-handler"></a>HTTP handler<a class="hash-link" href="#http-handler" title="Direct link to heading">#</a></h4><p>Similar to the otelmux library the <a href="https://github.com/trussworks/otelhttp" target="_blank" rel="noopener noreferrer">otelhttp library</a> is designed to wrap HTTP handler functions. It has built in events (read &amp; write) to report the request size, response size, and duration of the http request.  It is more configurable than the otelmux middleware allowing you to filter out certain routes and other controls.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly golang"><pre tabindex="0" class="prism-code language-golang codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">otelhttp.NewHandler(router, &quot;server-tls&quot;, []otelHTTP.Option{otelHTTP.ReadEvents, otelHTTP.WriteEvents})</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Note: This implementation has been forked to the Trussworks GitHub to address bug fixes.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="sql"></a>SQL<a class="hash-link" href="#sql" title="Direct link to heading">#</a></h4><p>The <a href="https://github.com/XSAM/otelsql" target="_blank" rel="noopener noreferrer">XSAM/otelsql</a> library wraps the queries to our Postgres database and appends a span to the trace with the statement and duration information.  Query parameters may be hidden to not log sensitive information.  It can also be used to log calls to cursor rows when paging through larger result sets.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="go"></a>Go<a class="hash-link" href="#go" title="Direct link to heading">#</a></h4><p>The <a href="https://github.com/open-telemetry/opentelemetry-go-contrib/tree/main/instrumentation/runtime" target="_blank" rel="noopener noreferrer">Go runtime instrumentation library</a> primarily provides statistics on memory usage and garbage collection cycles that may degrade performance.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="data-collection"></a>Data collection<a class="hash-link" href="#data-collection" title="Direct link to heading">#</a></h2><p>Data from the Milmove app is sent to the Open Telemetry collector, which processes the trace, metric, and log data and exports it to the services of our choice.  In AWS the collector exports to the Cloudwatch and AWS X-Ray services for storage and analysis.  When run locally the data is exported to the Elastic APM Server running Elasticsearch and Kibana. </p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="traces"></a>Traces<a class="hash-link" href="#traces" title="Direct link to heading">#</a></h3><p>A trace can be thought of as a tree linked structure of one or more spans that represent a segment of time.  A single trace may contain child spans that include the duration of the HTTP API request on the server and span(s) for the database calls within that lifecycle.  <a href="https://opentelemetry.io/docs/reference/specification/trace/semantic_conventions/" target="_blank" rel="noopener noreferrer">The Open Telemetry specification</a> defines semantic conventions that our libraries primarily follow for span attribute names and values.</p><p><strong>Common Trace fields</strong></p><ul><li>ID</li><li>Parent ID</li><li>Trace ID</li><li>Name</li><li>Kind</li><li>Start time</li><li>End time</li><li>Status code</li><li>Status message</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="http-requests"></a>HTTP Requests<a class="hash-link" href="#http-requests" title="Direct link to heading">#</a></h4><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">http.client_ip</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.flavor</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.host</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.method</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.scheme</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.server_name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.status_code</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.target</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.user_agent</span></span><span class="token-line" style="color:#393A34"><span class="token plain">http.wrote_bytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">net.host_ip</span></span><span class="token-line" style="color:#393A34"><span class="token plain">net.host_port</span></span><span class="token-line" style="color:#393A34"><span class="token plain">net.peer_ip</span></span><span class="token-line" style="color:#393A34"><span class="token plain">net.peer_port</span></span><span class="token-line" style="color:#393A34"><span class="token plain">net.transport</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="database-sql-statements"></a>Database SQL Statements<a class="hash-link" href="#database-sql-statements" title="Direct link to heading">#</a></h4><p>Spans/segments will be added to the current trace when database queries (Select) or executions (Update/Insert) are made within a request.</p><p><strong>sql.conn.exec</strong> (Update/Insert statements)</p><ul><li>db.statement</li></ul><p><strong>sql.conn.query</strong> (Select statements)</p><ul><li>db.system</li><li>db.statement</li></ul><p><strong>sql.rows</strong> (When using a rows cursor to iterate through database results)</p><ul><li>db.system</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="metrics"></a>Metrics<a class="hash-link" href="#metrics" title="Direct link to heading">#</a></h3><p>Open Telemetry defines three primary metric instrument types to be counters, measures, and observers.  Metric events should conform to the <a href="https://opentelemetry.io/docs/reference/specification/overview/#metric-signal" target="_blank" rel="noopener noreferrer">metrics specification</a>, which supports both non-aggregated and pre-aggregated measurements.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="http"></a>HTTP<a class="hash-link" href="#http" title="Direct link to heading">#</a></h4><p>HTTP Request Count</p><ul><li>HTTP Protocol Version</li><li>Host</li><li>Scheme</li><li>Server Name (TLS/MTLS/No-TLS)</li><li>Status Code</li><li>Target (URL path)</li></ul><p>HTTP Request Content Length</p><ul><li>HTTP Protocol Version</li><li>Host</li><li>Scheme</li><li>Server Name (TLS/MTLS/No-TLS)</li><li>Target (URL path)</li></ul><p>HTTP Response Content Length</p><ul><li>HTTP Protocol Version</li><li>Host</li><li>Scheme</li><li>Server Name (TLS/MTLS/No-TLS)</li><li>Target (URL path)</li></ul><p>HTTP Duration</p><ul><li>HTTP Protocol Version</li><li>Host</li><li>Scheme</li><li>Server Name (TLS/MTLS/No-TLS)</li><li>Target (URL path)</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="database-connections"></a>Database Connections<a class="hash-link" href="#database-connections" title="Direct link to heading">#</a></h4><p>Database Pool Connections</p><ul><li>Inuse</li><li>Idle</li><li>Wait Duration</li></ul><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="go-runtime"></a>Go Runtime<a class="hash-link" href="#go-runtime" title="Direct link to heading">#</a></h4><p>Copied from <a href="https://github.com/open-telemetry/opentelemetry-go-contrib/blob/main/instrumentation/runtime/doc.go" target="_blank" rel="noopener noreferrer">https://github.com/open-telemetry/opentelemetry-go-contrib/blob/main/instrumentation/runtime/doc.go</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.cgo.calls         -          Number of cgo calls made by the current process</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.gc.count          -          Number of completed garbage collection cycles</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.gc.pause_ns       (ns)       Amount of nanoseconds in GC stop-the-world pauses</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.gc.pause_total_ns (ns)       Cumulative nanoseconds in GC stop-the-world pauses since the program started</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.goroutines        -          Number of goroutines that currently exist</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.lookups           -          Number of pointer lookups performed by the runtime</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.mem.heap_alloc    (bytes)    Bytes of allocated heap objects</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.mem.heap_idle     (bytes)    Bytes in idle (unused) spans</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.mem.heap_inuse    (bytes)    Bytes in in-use spans</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.mem.heap_objects  -          Number of allocated heap objects</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.mem.heap_released (bytes)    Bytes of idle spans whose physical memory has been returned to the OS</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.mem.heap_sys      (bytes)    Bytes of heap memory obtained from the OS</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.mem.live_objects  -          Number of live objects is the number of cumulative Mallocs - Frees</span></span><span class="token-line" style="color:#393A34"><span class="token plain">runtime.go.runtime.uptime    (ms)       Milliseconds since application was initialized</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="aws-container-metrics"></a>AWS Container Metrics<a class="hash-link" href="#aws-container-metrics" title="Direct link to heading">#</a></h4><p>All containers running on AWS ECS can access container level metrics including memory, cpu, network, and storage usage.  In the <a href="https://aws-otel.github.io/docs/components/ecs-metrics-receiver" target="_blank" rel="noopener noreferrer">AWS otel collector</a> we connect the receiver and exporter to send data from the container through to Cloudwatch.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Task Level Metrics              Container Level               Metrics Unit</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.memory.usage           container.memory.usage        Bytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.memory.usage.max       container.memory.usage.max    Bytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.memory.usage.limit     container.memory.usage.limit  Bytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.memory.reserved        container.memory.reserved     Megabytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.memory.utilized        container.memory.utilized     Megabytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.usage.total        container.cpu.usage.total       Nanoseconds</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.usage.kernelmode   container.cpu.usage.kernelmode  Nanoseconds</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.usage.usermode     container.cpu.usage.usermode    Nanoseconds</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.usage.system       container.cpu.usage.system      Nanoseconds</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.usage.vcpu         container.cpu.usage.vcpu        vCPU</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.cores              container.cpu.cores             Count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.onlines            container.cpu.onlines           Count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.reserved           container.cpu.reserved          vCPU</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.cpu.utilized           container.cpu.utilized          Percent</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.rate.rx              container.network.rate.rx             Bytes/Second</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.rate.tx              container.network.rate.tx             Bytes/Second</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.io.usage.rx_bytes    container.network.io.usage.rx_bytes   Bytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.io.usage.rx_packets  container.network.io.usage.rx_packets Count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.io.usage.rx_errors   container.network.io.usage.rx_errors  Count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.io.usage.rx_dropped  container.network.io.usage.rx_dropped Count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.io.usage.tx_bytes    container.network.io.usage.tx_bytes   Bytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.io.usage.tx_packets  container.network.io.usage.tx_packets Count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.io.usage.tx_errors   container.network.io.usage.tx_errors  Count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.network.io.usage.tx_dropped  container.network.io.usage.tx_dropped Count</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.storage.read_bytes   container.storage.read_bytes  Bytes</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ecs.task.storage.write_bytes  container.storage.write_bytes Bytes</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="elasticache-redis"></a>Elasticache (Redis)<a class="hash-link" href="#elasticache-redis" title="Direct link to heading">#</a></h4><p>The Milmove app uses a Redis cache to store session data for auth purposes.  I omitted some of the credit balance metrics that infra uses but the full documentation is available here <a href="https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/CacheMetrics.Redis.html" target="_blank" rel="noopener noreferrer">https://docs.aws.amazon.com/AmazonElastiCache/latest/red-ug/CacheMetrics.Redis.html</a>.</p><ul><li>ActiveDefragHits</li><li>BytesUsedForCache</li><li>CacheHitRate</li><li>CacheHits</li><li>CacheMisses</li><li>CPUUtilization</li><li>CurrConnections</li><li>CurrItems</li><li>DatabaseMemoryUsagePercentage</li><li>DBOAveerageTTL</li><li>EngineCPUUtilization</li><li>Evictions</li><li>FreeableMemory</li><li>GetTypeCmds</li><li>GetTypeCmdsLatency</li><li>IsMaster</li><li>KeyBasedCmds</li><li>KeyBasedCmdsLatency</li><li>MasterLinkHealthStatus</li><li>MemoryFragmentationRatio</li><li>NetworkBytesIn</li><li>NetworkBytesOut</li><li>NetworkPacketsin</li><li>NetworkPacketsout</li><li>NewConnections</li><li>Reclaimed</li><li>ReplicationBytes</li><li>ReplicationLag</li><li>SaveInProgress</li><li>SetTypeCmds</li><li>SetTypeCmdsLatency</li><li>StringBasedCmds</li><li>StringBasedCmdsLatency</li><li>SwapUsage</li></ul><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="resources"></a>Resources<a class="hash-link" href="#resources" title="Direct link to heading">#</a></h3><p><a href="https://opentelemetry.io/" target="_blank" rel="noopener noreferrer">Open Telemetry Homepage</a></p><p><a href="https://opentelemetry.io/docs/go/" target="_blank" rel="noopener noreferrer">Open Telemetry for Golang</a></p><p><a href="https://aws-otel.github.io/" target="_blank" rel="noopener noreferrer">AWS Open Telmetry Docs</a></p><p><a href="https://www.elastic.co/observability/application-performance-monitoring" target="_blank" rel="noopener noreferrer">Elastic Application Performance Monitoring</a></p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/backend/guides/open-telemetry.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mymove-docs/docs/backend/guides/zip-code-to-rate-area-mappings"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Zip code to Rate area mappings</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mymove-docs/docs/backend/setup/configure-postico-or-tableplus-to-connect-to-mymove-db"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Configure Postico or TablePlus to connect to mymove DB Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#implementation" class="table-of-contents__link">Implementation</a><ul><li><a href="#environment-configuration" class="table-of-contents__link">Environment configuration</a></li><li><a href="#go-package" class="table-of-contents__link">Go package</a></li><li><a href="#instrumentation" class="table-of-contents__link">Instrumentation</a></li></ul></li><li><a href="#data-collection" class="table-of-contents__link">Data collection</a><ul><li><a href="#traces" class="table-of-contents__link">Traces</a></li><li><a href="#metrics" class="table-of-contents__link">Metrics</a></li><li><a href="#resources" class="table-of-contents__link">Resources</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tutorial">Docusaurus Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/api">API</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/tools">Tools</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>MilMove Documentation GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>MilMove GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://docusaurus.io/" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Docusaurus Official Docs<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2022 United States Transportation Command. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.1c4a4698.js"></script>
<script src="/mymove-docs/assets/js/main.8b649ace.js"></script>
</body>
</html>