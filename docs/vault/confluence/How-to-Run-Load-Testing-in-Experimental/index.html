<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">How-to-Run-Load-Testing-in-Experimental | MilMove Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/confluence/How-to-Run-Load-Testing-in-Experimental"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How-to-Run-Load-Testing-in-Experimental | MilMove Developer Portal"><meta data-react-helmet="true" name="description" content="Overview"><meta data-react-helmet="true" property="og:description" content="Overview"><link data-react-helmet="true" rel="shortcut icon" href="/mymove-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/confluence/How-to-Run-Load-Testing-in-Experimental"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/confluence/How-to-Run-Load-Testing-in-Experimental" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/confluence/How-to-Run-Load-Testing-in-Experimental" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.e9cb1a24.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.22e74290.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.5b4e7551.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">MilMove.dev</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/mymove-docs/api/prime">Prime</a></li><li><a class="dropdown__link" href="/mymove-docs/api/support">Support</a></li></ul></div><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/vault/">Documentation Vault</a></li><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/vault/[deprecated]-run-loki-tests-against-storybook">[deprecated]-run-loki-tests-against-storybook</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">confluence</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/Dependency-Update-Process-With-Dependabot">What is Dependabot</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/Deployment-Process">Deployment-Process</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/Disabled-or-Hidden-Moves">Disabled-or-Hidden-Moves</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/vault/confluence/How-to-Run-Load-Testing-in-Experimental">How-to-Run-Load-Testing-in-Experimental</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/Load-Testing">Principles of Load Testing</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/Performance-Testing-fetchMTOUpdates">Performance Testing `fetchMTOUpdates` Query</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/Setting-up-Internet-Explorer-11---Edge-Browser-in-Virtualbox">Setting-up-Internet-Explorer-11---Edge-Browser-in-Virtualbox</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/automatically-add-jira-id-to-commit-message">How to Automatically add JIRA ID to Commit Message</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/create-or-deactivate-users">How To Create or Deactivate Users</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/deploy-to-experimental">How to Deploy to Experimental or Demo</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/metrics">MilMove Application Metrics</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/confluence/pairing">Pairing Sessions</a></li></ul></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">infra</a></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>How-to-Run-Load-Testing-in-Experimental</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="overview"></a>Overview<a class="hash-link" href="#overview" title="Direct link to heading">#</a></h2><p>Load testing is the process of simulating large numbers of users on MilMove so that we can evaluate how the system is standing up against high demand. Our main objectives currently are to measure response times and identify any breaking points for the application.</p><p>All of our load tests will be run against the experimental deployment of MilMove using a <a href="https://github.com/transcom/milmove_load_testing" target="_blank" rel="noopener noreferrer">custom-built Locust app</a>. This app will be running on the computer of the developer who is initiating the test (a further iteration of this project would be to host the Locust app so it can run remotely). Considerations for running the tests:</p><ul><li><p>Ensure that <strong>no one else is using the experimental environment</strong> during the load tests. </p><p>We want our data to be consistent and comparable. We will accomplish this by following our previously established guidelines for claiming experimental.</p></li><li><p>Ensure that we <strong>restore the experimental database</strong> to its previous condition after the test has completed. </p><p> Each load test will add thousands of moves to the database, so we need to be able to clear this information out to prevent the system from being overburdened after just a few tests. We also do not want to interfere with data entered into the system by other users for their testing purposes.</p></li></ul><p><strong>The test will be run Thursday mornings at 6AM Pacific Time</strong>, but it may be rescheduled depending on folks&#x27; availability. Our test parameters are set as environment variables in the <code>prime-exp-reporting</code> service of our <code>docker-compose.yaml</code> file, seen here: <a href="https://github.com/transcom/milmove_load_testing/blob/03bb152dc1e78e5c15eaedb807af1355f960063d/docker-compose.yaml#L17-L25" target="_blank" rel="noopener noreferrer">https://github.com/transcom/milmove_load_testing/blob/03bb152dc1e78e5c15eaedb807af1355f960063d/docker-compose.yaml#L17-L25</a></p><p>At the time of editing this page, these settings mean:</p><ul><li>Each test will last 2 hours. </li><li>Each test will spawn 1000 users at a rate of 10 users/second. </li><li>The test will run in the developer&#x27;s console headless, without the web UI.</li><li>Reports will be saved in .csv format after each test. You can find past reports in <a href="https://drive.google.com/drive/folders/1v7WZc5x074mWaCPbZnq1K7RI5JINH1O8" target="_blank" rel="noopener noreferrer">Google Drive</a>.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="process"></a>Process<a class="hash-link" href="#process" title="Direct link to heading">#</a></h2><p>If you are the engineer in charge of running the load test in a given week, please follow these steps:</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="early-in-the-week-mondaytuesday"></a>Early in the week (Monday/Tuesday)<a class="hash-link" href="#early-in-the-week-mondaytuesday" title="Direct link to heading">#</a></h3><ol><li><p>Create a Jira ticket for the Infra On-Call team member for the week. You can use the pre-filled chore <a href="https://dp3.atlassian.net/secure/CreateIssueDetails!init.jspa?pid=10000&amp;issuetype=10002&amp;labels=team-infra&amp;priority=3&amp;summary=Load%20Testing%3A%20Monitor%20and%20Restore%20Experimental%20Database%20YYYY-MM-DD&amp;description=Load%20testing%20will%20be%20run%20against%20Experimental%20on%20MM%2FDD%2FYYYY.%0A%0ADuring%20this%20time%2C%20the%20Infra%20On-Call%20team%20member%20will%20need%20to%20be%20available%20to%20respond%20to%20any%20issues%20or%20critical%20failures%20that%20may%20arise.%20They%20will%20also%20need%20to%20restore%20the%20Experimental%20DB%20to%20its%20previous%20state%20after%20the%20test%20completes.%0A%0AInfra%20guides%3A%0Ahttps%3A%2F%2Fdocs.google.com%2Fdocument%2Fd%2F1sLcOyuFJdMq-bBqjNDfZGkFO-m9S5BdG0R9vuAWxYxA%2Fedit%0Ahttps%3A%2F%2Fgithub.com%2Ftranscom%2Ftranscom-infrasec-com%2Fblob%2Fmaster%2Fdocs%2Frunbook%2F0016-restoring-db-to-known-snapshot.md%0A%0AExperimental%20DB%20Snapshot%3A%0A%3Cpending%3E%0A" target="_blank" rel="noopener noreferrer">here</a> to streamline this process. These are the values you should have:</p><ul><li><strong>Issue Type:</strong> Chore</li><li><strong>Summary:</strong> Load Testing: Monitor and Restore Experimental Database <code>&lt;YYYY-MM-DD&gt;</code> </li><li><strong>Label:</strong> team-infra</li><li><strong>Priority:</strong> Medium</li><li><strong>Description:</strong> A prefilled description</li></ul><p>These are the values you should fill in:</p><ul><li><strong>Reporter:</strong> You (the app eng running the test)</li><li><strong>Assignee:</strong> The on-call infra eng - you can find who this is using <a href="https://movemil.pagerduty.com/schedules#PF78S2T" target="_blank" rel="noopener noreferrer">PagerDuty</a>.</li></ul><p>Copy the link to the new ticket and share it in #prac-infrasec channel. Tag their PM, Paul Sackley, to make sure he sees it. </p></li></ol><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="the-day-of-thursday"></a>The day of (Thursday)<a class="hash-link" href="#the-day-of-thursday" title="Direct link to heading">#</a></h3><ol start="2"><li><p>On the day of, post in #experimental-env to alert the team that you will be claiming experimental for the next 4 hours (the buffer time is for infra to restore the database after the test). In general, follow <a href="/mymove-docs/docs/vault/confluence/deploy-to-experimental">these guidelines for deploying to experimental</a>.</p></li><li><p>Once you have claimed experimental, checkout the <code>exp-load-testing</code> branch in <code>mymove</code> and ensure that it is up-to-date with the <code>master</code> branch. You can do this by running <code>git merge origin/master</code>.</p></li><li><p>In GitHub, identify the <a href="https://github.com/transcom/mymove/pull/5937" target="_blank" rel="noopener noreferrer">existing PR for this branch</a>. </p><ul><li>If there were changes merged in from <code>master</code>, make sure you push those up. That will trigger the experimental deployment.</li><li>If there were no changes, navigate to the <a href="https://app.circleci.com/pipelines/github/transcom/mymove?branch=exp-load-testing" target="_blank" rel="noopener noreferrer">CircleCI workflow for this branch</a> and click &quot;Rerun Workflow from Start&quot; to trigger the redeploy.</li></ul></li><li><p>Wait for experimental to redeploy. Once it has, navigate to the <code>deploy_exp_migrations</code> job in the CircleCI workflow. </p></li><li><p>Save the output from the &quot;Snapshot database&quot; step in this job, and open the Jira ticket you created in step one. In the <strong>Description</strong>, under the &quot;Experimental DB Snapshot:&quot; line, create a code block and paste in the full text of that output. Click &quot;Save&quot;. Infra will use this information to restore the database later. </p><ul><li><strong>NOTE:</strong> We may be able to automate the process of grabbing this info from CircleCI and then updating this ticket. Someday.</li></ul></li><li><p>Navigate to your <code>milmove_load_testing</code> repo, checkout and update the <code>master</code> branch, then enter the command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">make exp_load_test</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p> This will start the pre-defined load test. Go get a coffee or a foot massage and sit tight for the next 2 hours.</p></li><li><p>At 2 hours, check on the test. Verify that the reports and logs have been saved as files in the <code>static/reports</code> folder. You should see these five files: </p><ul><li><p><code>&lt;YYYY-MM-DD-HHIISS&gt;_exceptions.csv</code> - contains a record of any Python exceptions that may have been raised during the test. Ideally, this file should be empty.</p></li><li><p><code>&lt;YYYY-MM-DD-HHIISS&gt;_failures.csv</code> - contains a record of all of the request failures to occur during the test. We expect many 4xx responses, and there are some 500 errors that correspond to bugs we are aware of. Any other failures are unexpected and should be investigated after the test.</p></li><li><p><code>&lt;YYYY-MM-DD-HHIISS&gt;_logs.txt</code> - a plain-text dump of the all the output logs from the test. Currently, we are only printing logs with a level of WARNING or above, but this can be adjusted if we want to see more info or debug logs.</p></li><li><p><code>&lt;YYYY-MM-DD-HHIISS&gt;_stats.csv</code> - contains an aggregated record of the request statistics from the tests. Columns include # requests attempted per endpoint, # failures per endpoint, average response time, and so on.</p></li><li><p><code>&lt;YYYY-MM-DD-HHIISS&gt;_stats_history.csv</code> - the request statistics <em>over time</em> during the test. This is important to check to understand how consistent the failure rate was. Did it stay around the same failure % throughout the test? Or was there a sudden drop off with a rapid increase in failures?</p><p>   <code>&lt;YYYY-MM-DD-HHIISS&gt;</code> should correspond to the date and time when you executed the load test. Move these files into a folder named for the current date in the <a href="https://drive.google.com/drive/folders/1v7WZc5x074mWaCPbZnq1K7RI5JINH1O8" target="_blank" rel="noopener noreferrer">Load Testing GDrive folder</a>.</p><p>   <strong>NOTE:</strong> If your load test ended prematurely, either from an unexpected error or a manual interrupt (CTRL+C), you may need to manually copy over the reports from the docker container with this command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">docker cp mmlt_prime_exp_reporting:/app/static/reports static/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>   If the system experiences a critical fail and crashes, let infra know ASAP so they can begin the recovery process. This may involve a lot of work to diagnose the problem and fix it for the future, but we can view this as a valid outcome of the load test. We do not have to have a successful test to get valuable results.</p></li></ul></li><li><p>Tag the infra on-call person in #experimental-env to let them know that the load test has completed and they can rollback the experimental database (there is a doc for this process somewhere).</p></li><li><p>Infra will revert the database and then notify folks in #experimental-env to let them know that experimental is open for use again.</p></li></ol></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/vault/confluence/How-to-Run-Load-Testing-in-Experimental.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mymove-docs/docs/vault/confluence/Disabled-or-Hidden-Moves"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« Disabled-or-Hidden-Moves</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mymove-docs/docs/vault/confluence/Load-Testing"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Principles of Load Testing Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#overview" class="table-of-contents__link">Overview</a></li><li><a href="#process" class="table-of-contents__link">Process</a><ul><li><a href="#early-in-the-week-mondaytuesday" class="table-of-contents__link">Early in the week (Monday/Tuesday)</a></li><li><a href="#the-day-of-thursday" class="table-of-contents__link">The day of (Thursday)</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/help">Help</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/vault">Vault</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/database">Database</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/testing">Testing</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 United States Transportation Command. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.22e74290.js"></script>
<script src="/mymove-docs/assets/js/main.5b4e7551.js"></script>
</body>
</html>