<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">How to Search for Application Errors | MilMove Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/infra/search-for-application-errors"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How to Search for Application Errors | MilMove Developer Portal"><meta data-react-helmet="true" name="description" content="Searching for errors from the application can be difficult.  Here is a playbook for finding specific errors."><meta data-react-helmet="true" property="og:description" content="Searching for errors from the application can be difficult.  Here is a playbook for finding specific errors."><link data-react-helmet="true" rel="shortcut icon" href="/mymove-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/infra/search-for-application-errors"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/infra/search-for-application-errors" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/infra/search-for-application-errors" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.e9cb1a24.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.6137c858.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.8ef640ee.js" as="script">
</head>
<body data-theme="light">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">MilMove.dev</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/mymove-docs/api/prime">Prime</a></li><li><a class="dropdown__link" href="/mymove-docs/api/support">Support</a></li></ul></div><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="dsla-search-wrapper"><div class="dsla-search-field"></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/vault/">Documentation Vault</a></li><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/vault/[deprecated]-run-loki-tests-against-storybook">[deprecated]-run-loki-tests-against-storybook</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">confluence</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">infra</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/How-to-Search-AWS-Cloudwatch-Logs-using-Instance-ID">How-to-Search-AWS-Cloudwatch-Logs-using-Instance-ID</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/How-to-use-the-benchmarking-script-with-Puppeteer-and-Lighthouse">Description</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/Test-Sending-Email-in-Devlocal">Test-Sending-Email-in-Devlocal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/Test-Storing-Data-in-S3-in-Devlocal">Test-Storing-Data-in-S3-in-Devlocal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/anti_virus">Anti-Virus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/create-an-ecs-scheduled-task">How To Create An ECS Scheduled Task</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/run-against-s3-locally">How To Run Against S3 &amp; CDN Locally</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/vault/infra/search-for-application-errors">How to Search for Application Errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/view-ecs-service-logs">How to View ECS Service Logs</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>How to Search for Application Errors</h1></header><p>Searching for errors from the application can be difficult.  Here is a playbook for finding specific errors.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="video-examples"></a>Video examples<a class="hash-link" href="#video-examples" title="Direct link to heading">#</a></h2><p>A couple of videos walking through the process of searching alb and application logs</p><ul><li><a href="https://zoom.us/rec/share/7u5yIuDO02xOWYHuzWz5Zpw4EYH4X6a81XBNr_EPxBw4iI9Ojy7W0SYGJM9lSdQD" target="_blank" rel="noopener noreferrer">Video walking through finding application errors 2020-01-08</a></li><li><a href="https://zoom.us/recording/play/2DGo7KYqrvSAYvvEo2--zG_xx93K0ALUMLHJVXJl0X9WRo0lxkXXLAxp8IPHHDA8" target="_blank" rel="noopener noreferrer">A video of searching ALB errors</a>
to see how this is done in real time. <strong>This Video is older and parts maybe out of date</strong></li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="tips"></a>Tips<a class="hash-link" href="#tips" title="Direct link to heading">#</a></h2><ul><li>Always check the timezone of the log messages. Messages from AWS infrastructure are in UTC whereas log messages
from the app may be in PST.</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="playbook"></a>Playbook<a class="hash-link" href="#playbook" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="tracking-alb-errors-in-s3"></a>Tracking ALB Errors in S3<a class="hash-link" href="#tracking-alb-errors-in-s3" title="Direct link to heading">#</a></h3><p><strong>NOTE:</strong> ALB logs are only stored in AWS S3. You can search them by downloading them locally and searching via the
command line with the tools below or by using AWS Athena in the AWS Console.</p><p>Often we&#x27;ll see 500 errors from the application that trigger the <code>alb-staging-target-5xx-limit</code> alarm on the ALB.
The text is not super helpful:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly txt"><pre tabindex="0" class="prism-code language-txt codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">Alarm Name</span></span><span class="token-line" style="color:#393A34"><span class="token plain">alb-staging-target-5xx-limit</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Alarm Description</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Target(s) behind ALB in staging are returning 5xx error codes.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Alarm reason</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Threshold Crossed: 1 datapoint [2.0 (07/01/19 19:39:00)] was greater than or equal to the threshold (2.0).</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Old State</span></span><span class="token-line" style="color:#393A34"><span class="token plain">OK</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Current State</span></span><span class="token-line" style="color:#393A34"><span class="token plain">ALARM</span></span><span class="token-line" style="color:#393A34"><span class="token plain">Link to Alarm</span></span><span class="token-line" style="color:#393A34"><span class="token plain">https://console.aws.amazon.com/cloudwatch/home?region=us-west-2#alarm:alarmFilter=ANY;name=alb-staging-target-5xx-limit</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>A simple way to scan the logs is to use a helpful script we&#x27;ve built:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">../scripts/scan-alb-logs staging 500 2019/01/09,2019/01/10</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can be more specific with particular domains:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">../scripts/scan-alb-logs staging 500 2019/01/09,2019/01/10 office.move.mil</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><strong>NOTE:</strong> You cannot specify date ranges! You must specify each individual date.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="more-in-depth-scanning"></a>More in depth scanning<a class="hash-link" href="#more-in-depth-scanning" title="Direct link to heading">#</a></h3><p>If you want more control over the results you can continue here OR you can move on to the next section about understanding
ALB log entries.</p><p>You can download ALB logs for a specific date by using our <code>download-alb-logs</code> command line tool with:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">../scripts/download-alb-logs tmp prod 2019/01/09,2019/01/10</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Alternatively, you can run the <code>sync</code> commands manually as:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p tmp/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">aws s3 sync s3://transcom-ppp-aws-logs/alb/app-staging/AWSLogs/923914045601/elasticloadbalancing/us-west-2/2019/01/09/ ./tmp/</span></span><span class="token-line" style="color:#393A34"><span class="token plain">aws s3 sync s3://transcom-ppp-aws-logs/alb/app-staging/AWSLogs/923914045601/elasticloadbalancing/us-west-2/2019/01/10/ ./tmp/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>Then search for the errors in the ALB logs using <code>big-cat</code>, <code>gunzip</code>, <code>read-alb-logs</code>, and <code>jq</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">make build_tools</span></span><span class="token-line" style="color:#393A34"><span class="token plain">export http_code=500</span></span><span class="token-line" style="color:#393A34"><span class="token plain">big-cat &#x27;./tmp/*.log.gz&#x27; | gunzip | read-alb-logs | jq &quot;. | select( .elbStatusCode | startswith(\&quot;${http_code}\&quot;)) | {timestamp, clientPort, elbStatusCode, targetStatusCode, request, actionsExecuted}&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>And you&#x27;ll see events like this:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sh"><pre tabindex="0" class="prism-code language-sh codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;timestamp&quot;: &quot;2019-06-04T16:49:53.728140Z&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;clientPort&quot;: &quot;193.232.106.88:47233&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;elbStatusCode&quot;: &quot;403&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;targetStatusCode&quot;: &quot;-&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;request&quot;: &quot;GET https://54.201.161.247:443/.env HTTP/1.1&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;actionsExecuted&quot;: &quot;waf&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;timestamp&quot;: &quot;2019-06-04T17:13:30.820491Z&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;clientPort&quot;: &quot;180.248.30.194:57707&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;elbStatusCode&quot;: &quot;403&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;targetStatusCode&quot;: &quot;-&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;request&quot;: &quot;GET http://54.201.161.247:80/ HTTP/1.1&quot;,</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  &quot;actionsExecuted&quot;: &quot;waf&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can use any <code>jq</code> filter you want on the output data like filtering on timestamp.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="an-alternate-way-to-query-alb-logs-is-using-athena"></a>An alternate way to query alb logs is using Athena<a class="hash-link" href="#an-alternate-way-to-query-alb-logs-is-using-athena" title="Direct link to heading">#</a></h3><p>To query using Athena follow these steps:</p><ol><li>Navigate to <a href="https://us-west-2.console.aws.amazon.com/athena/home?region=us-west-2#query/history/e6bbe351-39ae-415d-9bfa-b3c00b9b8fb4" target="_blank" rel="noopener noreferrer">Athena</a></li><li>Make sure you have selected the correct database, for prod you should have selected <code>prod_alb_logs</code></li><li>Run the folloeing query to narrow down the records, make sure you update year and month for faster/cheaper response.</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><pre tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">SELECT</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">type</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">         elb_status_code</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">         actions_executed</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">         </span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">         from_iso8601_timestamp</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">time</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">AS</span><span class="token plain"> timestmp</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">FROM</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;alb_logs&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">WHERE</span><span class="token plain"> elb_status_code </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">499</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">year</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2020</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">AND</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">month</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">ORDER</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">BY</span><span class="token plain">  timestmp </span><span class="token keyword" style="color:#00009f">DESC</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">limit</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithStickyNavbar_31ik" id="understanding-alb-log-entries"></a>Understanding ALB Log Entries<a class="hash-link" href="#understanding-alb-log-entries" title="Direct link to heading">#</a></h4><p>References:</p><ul><li><a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-access-logs.html" target="_blank" rel="noopener noreferrer">AWS ALB Log Entries</a></li></ul><p>There are two forms of <code>elb_status_code target_status_code</code> that you&#x27;ll see on a log line, <code>200 200</code> or <code>301 -</code>. The first
is the ELB status code, which is what the user sees.  The second is the Target status code, which is what the application
container is returning. If the Target status code is <code>-</code> that means that the ALB did not forward the traffic from the
user to the application container or the application container failed to respond.</p><p>The most common reason you&#x27;re looking at these logs is to debug 5XX errors. Here is a short key for things you&#x27;ll see:</p><table><thead><tr><th>Code</th><th>Common meaning</th></tr></thead><tbody><tr><td>500</td><td>The application is returning a 500 from an unhandled error.</td></tr><tr><td>501</td><td>The ALB returns a 501 when it receives an <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/load-balancer-troubleshooting.html#http-501-issues" target="_blank" rel="noopener noreferrer">unsupported Transfer-Encoding header</a>, e.g, <code>Transfer-Encoding: defalate</code>.</td></tr><tr><td>502</td><td>The container was recycled because the ALB told ECS that the container was unhealthy.</td></tr></tbody></table><p>You can manually generate a 501 error with a deflate encoding: <code>curl -v -X POST --http1.1 -H &quot;Transfer-Encoding: deflate&quot; https://example.com</code>.</p><p>Its rare but sometimes the WAF has problems. You can check the <code>actions_executed</code> field in the ALB log to find out
what has happened. Normal traffic actions are <code>waf,forward</code>, which indicates the WAF analyzed the request and forwarded it to the container. If traffic was blocked by the WAF, you&#x27;ll just see <code>waf</code>.  If the WAF itself had problems (which happens very rarely), you&#x27;ll see <code>waf-failed</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="tracing-application-errors-in-cloudwatch"></a>Tracing Application Errors in CloudWatch<a class="hash-link" href="#tracing-application-errors-in-cloudwatch" title="Direct link to heading">#</a></h3><p>After finding the ALB error messages the next best thing to do is to open up CloudWatch Logs and look into either
<code>ecs-tasks-app-&lt;environment&gt;</code> or <code>ecs-tasks-app-client-tls-&lt;environment&gt;</code>.  As an example you can look into the logs
for Staging here:</p><p><a href="https://console.amazonaws-us-gov.com/cloudwatch/home?region=us-gov-west-1#logStream:group=ecs-tasks-app-stg" target="_blank" rel="noopener noreferrer">ecs-tasks-app-stg log streams</a></p><p>It&#x27;s worth noting that each container running in Fargate creates a unique Log Stream. That means you&#x27;ll have to
look through several log streams to find the events corresponding to the alarm.  The best way to do this is to
match up the <code>Last Event Time</code> with the time listed in the ALB alarm.</p><p>Open up the log stream and search for <code>{ $.resp-status &gt; 499 }</code> in the search bar.  Here&#x27;s an example:</p><p><a href="https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#logEventViewer:group=ecs-tasks-app-staging;stream=app/app-staging/c0fce04c-d248-4e90-b7c0-a4a5db187c68;filter=%7B%20$.resp-status%20%3E%20499%20%7D;start=2019-01-06T20:40:04Z" target="_blank" rel="noopener noreferrer">errors in log stream</a></p><p>You can glean a couple useful pieces of information from the log message.  Look especially at these items if they exist:</p><ul><li>git-commit</li><li>host</li><li>url</li><li>user-id</li><li>service-member-id</li><li>office-user-id</li><li>admin-user-id</li></ul><p>Most logged error messages come after the log lines that have useful information.  The best way to find those lines is to limit the log stream to a period of time that surrounds the error message you&#x27;re looking at.</p><p>With the URL route and the user information you can usually track down the piece of code that is causing the issue.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="alternative-method-for-tracing-application-errors-in-cloudwatch"></a>Alternative Method for Tracing Application Errors in CloudWatch<a class="hash-link" href="#alternative-method-for-tracing-application-errors-in-cloudwatch" title="Direct link to heading">#</a></h3><ol><li>Navigate to <a href="https://us-west-2.console.aws.amazon.com/cloudwatch/home?region=us-west-2#logs-insights:queryDetail=~(end~&#x27;2020-05-16T03*3a59*3a59.999Z~start~&#x27;2020-05-15T04*3a00*3a00.000Z~timeType~&#x27;ABSOLUTE~tz~&#x27;Local~editorString~&#x27;fields*20*40timestamp*2c*20*40message*2c*20url*2c*20*60resp-status*60*0a*7c*20sort*20*40timestamp*20desc*0a*7c*20filter*20*60x-forwarded-for*60*20*3d*20*2298.150.90.145*22*0a*7c*20limit*202000~isLiveTail~false~queryId~&#x27;48b8513b-b1a3-447b-a5cd-4ee0a3f65739~source~(~&#x27;ecs-tasks-app-prod))" target="_blank" rel="noopener noreferrer">cloudwatch insights</a></li><li>Make sure you have the correct log stream selected, for production environment you should have:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">ecs-task-app-prod</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><ol start="3"><li>Run a query to narrow down records, the following query can be useful </li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">fields @timestamp, @message, url</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| sort @timestamp desc</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| filter `x-forwarded-for` = &quot;98.150.90.145&quot;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| limit 2000</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="tracking-down-users-in-staging"></a>Tracking down users in Staging<a class="hash-link" href="#tracking-down-users-in-staging" title="Direct link to heading">#</a></h3><p>If you have the <code>office-user-id</code> or <code>admin-user-id</code> you can run <code>make run_prod_migrations</code> to download the secret
prod migrations locally and match the users.</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/vault/infra/search-for-application-errors.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mymove-docs/docs/vault/infra/run-against-s3-locally"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« How To Run Against S3 &amp; CDN Locally</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mymove-docs/docs/vault/infra/view-ecs-service-logs"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to View ECS Service Logs Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#video-examples" class="table-of-contents__link">Video examples</a></li><li><a href="#tips" class="table-of-contents__link">Tips</a></li><li><a href="#playbook" class="table-of-contents__link">Playbook</a><ul><li><a href="#tracking-alb-errors-in-s3" class="table-of-contents__link">Tracking ALB Errors in S3</a></li><li><a href="#more-in-depth-scanning" class="table-of-contents__link">More in depth scanning</a></li><li><a href="#an-alternate-way-to-query-alb-logs-is-using-athena" class="table-of-contents__link">An alternate way to query alb logs is using Athena</a></li><li><a href="#tracing-application-errors-in-cloudwatch" class="table-of-contents__link">Tracing Application Errors in CloudWatch</a></li><li><a href="#alternative-method-for-tracing-application-errors-in-cloudwatch" class="table-of-contents__link">Alternative Method for Tracing Application Errors in CloudWatch</a></li><li><a href="#tracking-down-users-in-staging" class="table-of-contents__link">Tracking down users in Staging</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/help">Help</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/vault">Vault</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/database">Database</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/testing">Testing</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 United States Transportation Command. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.6137c858.js"></script>
<script src="/mymove-docs/assets/js/main.8ef640ee.js"></script>
</body>
</html>