<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.5">
<title data-react-helmet="true">How To Run Against S3 &amp; CDN Locally | MilMove Developer Portal</title><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/infra/run-against-s3-locally"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_version" content="current"><meta data-react-helmet="true" name="docusaurus_tag" content="docs-default-current"><meta data-react-helmet="true" property="og:title" content="How To Run Against S3 &amp; CDN Locally | MilMove Developer Portal"><meta data-react-helmet="true" name="description" content="The app defaults to using the local filesystem to store uploaded files in development mode. This is to simplify development setup and"><meta data-react-helmet="true" property="og:description" content="The app defaults to using the local filesystem to store uploaded files in development mode. This is to simplify development setup and"><link data-react-helmet="true" rel="shortcut icon" href="/mymove-docs/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/infra/run-against-s3-locally"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/infra/run-against-s3-locally" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://transcom.github.io/mymove-docs//mymove-docs/docs/vault/infra/run-against-s3-locally" hreflang="x-default"><link rel="stylesheet" href="/mymove-docs/assets/css/styles.d6ed9481.css">
<link rel="preload" href="/mymove-docs/assets/js/runtime~main.b9708d32.js" as="script">
<link rel="preload" href="/mymove-docs/assets/js/main.2f3bd36f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/mymove-docs/"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/mymove-docs/img/logo.svg" alt="MilMove Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">MilMove.dev</b></a><a class="navbar__item navbar__link" href="/mymove-docs/docs/about/">About</a><a class="navbar__item navbar__link" href="/mymove-docs/docs/">Docs</a><div class="navbar__item dropdown dropdown--hoverable"><a class="navbar__link">APIs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/mymove-docs/api/prime">Prime</a></li><li><a class="dropdown__link" href="/mymove-docs/api/support">Support</a></li></ul></div><a class="navbar__item navbar__link" href="/mymove-docs/docs/help/">Help</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/transcom/mymove" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>mymove<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_31aa"><button class="clean-btn backToTopButton_35hR" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><aside class="docSidebarContainer_3Kbt"><div class="sidebar_15mo"><nav class="menu thin-scrollbar menu_Bmed menuWithAnnouncementBar_2WvA"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/vault/">Documentation Vault</a></li><li class="menu__list-item"><a class="menu__link" href="/mymove-docs/docs/vault/[deprecated]-run-loki-tests-against-storybook">[deprecated]-run-loki-tests-against-storybook</a></li><li class="menu__list-item menu__list-item--collapsed"><a class="menu__link menu__link--sublist" href="#">confluence</a></li><li class="menu__list-item"><a class="menu__link menu__link--sublist menu__link--active" href="#">infra</a><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/How-to-Search-AWS-Cloudwatch-Logs-using-Instance-ID">How-to-Search-AWS-Cloudwatch-Logs-using-Instance-ID</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/How-to-use-the-benchmarking-script-with-Puppeteer-and-Lighthouse">Description</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/Test-Sending-Email-in-Devlocal">Test-Sending-Email-in-Devlocal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/Test-Storing-Data-in-S3-in-Devlocal">Test-Storing-Data-in-S3-in-Devlocal</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/anti_virus">Anti-Virus</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/create-an-ecs-scheduled-task">How To Create An ECS Scheduled Task</a></li><li class="menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/mymove-docs/docs/vault/infra/run-against-s3-locally">How To Run Against S3 &amp; CDN Locally</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/search-for-application-errors">How to Search for Application Errors</a></li><li class="menu__list-item"><a class="menu__link" tabindex="0" href="/mymove-docs/docs/vault/infra/view-ecs-service-logs">How to View ECS Service Logs</a></li></ul></li></ul></nav></div></aside><main class="docMainContainer_3ufF"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_3FnS"><div class="docItemContainer_33ec"><article><div class="tocCollapsible_1PrD tocMobile_3Hoh"><button type="button" class="clean-btn tocCollapsibleButton_2O1e">On this page</button></div><div class="markdown"><header><h1>How To Run Against S3 &amp; CDN Locally</h1></header><p>The app defaults to using the local filesystem to store uploaded files in development mode. This is to simplify development setup and
make it easy to inspect uploaded files while developing features. In some situations, though, it is desirable to instead have
uploaded files stored on the real S3 service and served either by S3 directly or through a CDN like cloudfront.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="prerequisites"></a>Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">#</a></h2><p>You need to have followed <a href="https://github.com/transcom/transcom-infrasec-com/tree/master/transcom-ppp" target="_blank" rel="noopener noreferrer">the instructions to setup your AWS developer credentials</a> in order for the following commands to work.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithStickyNavbar_31ik" id="upload-files-to-s3"></a>Upload Files to S3<a class="hash-link" href="#upload-files-to-s3" title="Direct link to heading">#</a></h2><p>The environment variable <code>STORAGE_BACKEND</code> specifies if files should be stored on <code>s3</code>, on s3 but using <code>cdn</code>, on the <code>local</code> filesystem, or in <code>memory</code>. The default value is <code>local</code> in development and <code>s3</code> when the app is running in any deployed environment.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="using-the-devlocal-bucket"></a>Using the DevLocal Bucket<a class="hash-link" href="#using-the-devlocal-bucket" title="Direct link to heading">#</a></h3><p>Assuming your AWS credentials are setup properly, this command will configure the app to upload to the <code>transcom-ppp-app-devlocal-us-west-2</code> S3 bucket:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly console"><pre tabindex="0" class="prism-code language-console codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ env STORAGE_BACKEND=s3 make server_run_standalone</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p><em>Please note that this does not use our usual setup to automatically reload changes to files in the <code>swagger</code> directory. Other code changes should still be detected, however.</em></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="upload-files-to-s3-but-serve-from-cdn"></a>Upload Files to S3 but serve from CDN<a class="hash-link" href="#upload-files-to-s3-but-serve-from-cdn" title="Direct link to heading">#</a></h3><p>Instead of serving files from S3 bucket you can also use the CDN. Your files still upload to S3 but get served from CDN as a signed <a href="https://assets.devlocal.move.mil/your-user/user/xxxxxx-xxx-xxx-xxx" target="_blank" rel="noopener noreferrer">URL</a> instead of S3 bucket [URL]. To use CDN:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> </span><span class="token function" style="color:#d73a49">env</span><span class="token plain"> </span><span class="token assign-left variable" style="color:#36acaa">STORAGE_BACKEND</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">cdn </span><span class="token function" style="color:#d73a49">make</span><span class="token plain"> server_run_standalone</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="listing-files-on-s3"></a>Listing Files on S3<a class="hash-link" href="#listing-files-on-s3" title="Direct link to heading">#</a></h3><p>If you want to see what files have been uploaded to an S3 bucket through the console, use <code>aws s3 ls</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># list all files uploaded to the devlocal bucket by you</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ aws s3 </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> --recursive s3://transcom-ppp-app-devlocal-us-west-2/</span><span class="token variable" style="color:#36acaa">$AWS_S3_KEY_NAMESPACE</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># You can set $AWS_S3_KEY_NAMESPACE in .envrc.local, but it will default</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># to your local username</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">$ aws s3 </span><span class="token function" style="color:#d73a49">ls</span><span class="token plain"> --recursive s3://transcom-ppp-app-devlocal-us-west-2/bilbo</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithStickyNavbar_31ik" id="cleaning-up-s3"></a>Cleaning up S3<a class="hash-link" href="#cleaning-up-s3" title="Direct link to heading">#</a></h3><p>When you are done testing, remove any uploaded objects from the S3 bucket using the following command:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">$ aws s3 </span><span class="token function" style="color:#d73a49">rm</span><span class="token plain"> --recursive s3://transcom-ppp-app-devlocal-us-west-2/</span><span class="token variable" style="color:#36acaa">$AWS_S3_KEY_NAMESPACE</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>This will delete all files from the <code>dev-local</code> bucket that were uploaded by you. Use the above listing command to verify that this worked.</p></div><footer class="docusaurus-mt-lg"><div class="row"><div class="col"><a href="https://github.com/transcom/mymove-docs/edit/main/docs/vault/infra/run-against-s3-locally.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_13-_"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/mymove-docs/docs/vault/infra/create-an-ecs-scheduled-task"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Â« How To Create An ECS Scheduled Task</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/mymove-docs/docs/vault/infra/search-for-application-errors"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">How to Search for Application Errors Â»</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#prerequisites" class="table-of-contents__link">Prerequisites</a></li><li><a href="#upload-files-to-s3" class="table-of-contents__link">Upload Files to S3</a><ul><li><a href="#using-the-devlocal-bucket" class="table-of-contents__link">Using the DevLocal Bucket</a></li><li><a href="#upload-files-to-s3-but-serve-from-cdn" class="table-of-contents__link">Upload Files to S3 but serve from CDN</a></li><li><a href="#listing-files-on-s3" class="table-of-contents__link">Listing Files on S3</a></li><li><a href="#cleaning-up-s3" class="table-of-contents__link">Cleaning up S3</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Docs</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/about">About</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs">Getting Started</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/help">Help</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/vault">Vault</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/intro">Tutorial</a></li></ul></div><div class="col footer__col"><div class="footer__title">Contributing</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/frontend">Frontend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/backend">Backend</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/contributing/database">Database</a></li><li class="footer__item"><a class="footer__link-item" href="/mymove-docs/docs/dev/testing">Testing</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/transcom/mymove-docs" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 United States Transportation Command. Built with Docusaurus.</div></div></div></footer></div>
<script src="/mymove-docs/assets/js/runtime~main.b9708d32.js"></script>
<script src="/mymove-docs/assets/js/main.2f3bd36f.js"></script>
</body>
</html>