"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[3835],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return h}});var a=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=a.createContext({}),p=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=p(e.components);return a.createElement(l.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,l=e.parentName,c=s(e,["components","mdxType","originalType","parentName"]),u=p(n),h=i,m=u["".concat(l,".").concat(h)]||u[h]||d[h]||r;return n?a.createElement(m,o(o({ref:t},c),{},{components:n})):a.createElement(m,o({ref:t},c))}));function h(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,o=new Array(r);o[0]=u;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var p=2;p<r;p++)o[p]=n[p];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},1359:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return s},contentTitle:function(){return l},metadata:function(){return p},toc:function(){return c},default:function(){return u}});var a=n(7462),i=n(3366),r=(n(7294),n(3905)),o=["components"],s={},l="Route Planner Guide",p={unversionedId:"old-wiki/route-planner",id:"old-wiki/route-planner",isDocsHomePage:!1,title:"Route Planner Guide",description:"Table of Contents",source:"@site/docs/old-wiki/route-planner.md",sourceDirName:"old-wiki",slug:"/old-wiki/route-planner",permalink:"/docs/old-wiki/route-planner",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/old-wiki/route-planner.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"How to revert a change",permalink:"/docs/old-wiki/revert-a-change"},next:{title:"How to Run Acceptance Tests",permalink:"/docs/old-wiki/run-acceptance-tests"}},c=[{value:"Table of Contents",id:"table-of-contents",children:[]},{value:"Route planner interface",id:"route-planner-interface",children:[{value:"Interface methods",id:"interface-methods",children:[]}]},{value:"Available route planners",id:"available-route-planners",children:[{value:"HERE API",id:"here-api",children:[]},{value:"Bing API",id:"bing-api",children:[]},{value:"Test",id:"test",children:[]}]},{value:"Zip5ToLatLong",id:"zip5tolatlong",children:[]},{value:"Chamber",id:"chamber",children:[]},{value:"Testing",id:"testing",children:[]}],d={toc:c};function u(e){var t=e.components,n=(0,i.Z)(e,o);return(0,r.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"route-planner-guide"},"Route Planner Guide"),(0,r.kt)("h2",{id:"table-of-contents"},"Table of Contents"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#route-planner-interface"},"Route planner interface"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#interface-methods"},"Interface methods")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#available-route-planners"},"Available route planners"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#here-api"},"HERE API"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#transitdistance"},"TransitDistance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#zip5transitdistance"},"Zip5TransitDistance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#zip3transitdistance"},"Zip3TransitDistance")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#latlongtransitdistance"},"LatLongTransitDistance")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#bing-api"},"Bing API")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#test"},"Test")))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#zip5tolatlong"},"Zip5ToLatLong")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#chamber"},"Chamber")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#testing"},"Testing"))),(0,r.kt)("p",null,'Regenerate with "pre-commit run -a markdown-toc"'),(0,r.kt)("h2",{id:"route-planner-interface"},"Route planner interface"),(0,r.kt)("p",null,"In the MyMove project we have an interface for communicating with various Route planning APIs. Currently the project uses the HERE api for distance route calculations. The hope of this doc is to explain some of how it works. The interface and implementations can be found in ",(0,r.kt)("inlineCode",{parentName:"p"},"pkg/route"),"."),(0,r.kt)("h3",{id:"interface-methods"},"Interface methods"),(0,r.kt)("p",null,"The Route Planner interface requires the implementation of the following methods."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"// This method takes a source and destination `models.Address` and returns the distance as an `int`.\nTransitDistance(source *models.Address, destination *models.Address) (int, error)\n\n//This method takes a source and destination `LatLong` and returns the distance as an `int`\nLatLongTransitDistance(source LatLong, destination LatLong) (int, error)\n\n// This method takes a source and destination `Zip5` string and returns the distance as an `int`\nZip5TransitDistance(source string, destination string) (int, error)\n\n// This method takes a source and destination `Zip3` string and returns the distance as an `int`\nZip3TransitDistance(source string, destination string) (int, error)\n")),(0,r.kt)("h2",{id:"available-route-planners"},"Available route planners"),(0,r.kt)("p",null,"Below is a list of the current route planner APIs that are implemented, though it appears as of this writing that only HERE API is used."),(0,r.kt)("h3",{id:"here-api"},"HERE API"),(0,r.kt)("p",null,"The HERE API is the currently used 3rd party api for doing route planning in the my move system."),(0,r.kt)("h4",{id:"transitdistance"},"TransitDistance"),(0,r.kt)("p",null,"Turns the input addresses into ",(0,r.kt)("inlineCode",{parentName:"p"},"LatLong")," data via HERE geocoder endpoint, and then it runs the ",(0,r.kt)("inlineCode",{parentName:"p"},"LatLongTransitDistance")," method to determine the distance."),(0,r.kt)("h4",{id:"zip5transitdistance"},"Zip5TransitDistance"),(0,r.kt)("p",null,"Uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"Zip5ToLatLong")," method to turn the input Zip5s into ",(0,r.kt)("inlineCode",{parentName:"p"},"LatLong")," data and then uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"LatLongTransitDistance")," method to determine the distance."),(0,r.kt)("h4",{id:"zip3transitdistance"},"Zip3TransitDistance"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Zip3TransitDistance")," is unimplemented and always returns a ",(0,r.kt)("inlineCode",{parentName:"p"},"NewUnsupportedPostalCodeError")),(0,r.kt)("p",null,"This method was added to support the requirement that some service item pricing in the rate engine, ie Domestic Linehaul, will use Zip3 based distance calculations. This expectation is documented in the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.google.com/spreadsheets/d/1NRbxHmvaWV6aXQrxQ2LJhkc5tClAl3Eb1-MRxZ123Tw/edit#gid=0"},"service item pricing spreadsheet")," (Google Docs Link). However, the HERE api uses pre-calculated Zip5 to Latitude and Longitude coordinate map to turn Zip5s into coordinates and then uses the LatLongTransitDistance function to return a distance. Since currently there is no such Zip3 to Latitude and Longitude coordinates map there is no way to do a similar calculation of distance. In talking with product about this we decided if there was not an easy way to implement Zip3 distance in HERE we would only add a stub so that work could continue until a new 3rd party planner, ie Rand McNally, was implemented and could supply a valid Zip3 to Zip3 distance calculation."),(0,r.kt)("h4",{id:"latlongtransitdistance"},"LatLongTransitDistance"),(0,r.kt)("p",null,"This method takes a source and destination ",(0,r.kt)("inlineCode",{parentName:"p"},"LatLong")," and uses the HERE API to calculate the distance between them."),(0,r.kt)("h3",{id:"bing-api"},"Bing API"),(0,r.kt)("p",null,"This is an implementation of the Planner interface that uses Bing as a backend. However, as of this writing there are no uses of this class other than in tests."),(0,r.kt)("h3",{id:"test"},"Test"),(0,r.kt)("p",null,"This is an implementation of the Planner interface to be used in various tests."),(0,r.kt)("h2",{id:"zip5tolatlong"},"Zip5ToLatLong"),(0,r.kt)("p",null,"The HERE API relies on zip to LatLong data from the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/midwire/free_zipcode_data"},"free zip code data project"),". This data was used to create a static map of Zip5s to LatLong tuples in\n",(0,r.kt)("inlineCode",{parentName:"p"},"pkg/route/zip_locale.go"),". This file also contains the method which can be used to lookup the data."),(0,r.kt)("h2",{id:"chamber"},"Chamber"),(0,r.kt)("p",null,"The following environment variables need to be set to make successful calls to the API. These values are stored in chamber so they are not be checked in."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-sh"},"HERE_MAPS_APP_ID\nHERE_MAPS_ROUTING_ENDPOINT\nHERE_MAPS_APP_CODE\nHERE_MAPS_GEOCODE_ENDPOINT\n")),(0,r.kt)("h2",{id:"testing"},"Testing"),(0,r.kt)("p",null,"There are unit tests under ",(0,r.kt)("inlineCode",{parentName:"p"},"<planner_name>_test.go")," which do some basic validation. There is an integration test which calls out to the real api in ",(0,r.kt)("inlineCode",{parentName:"p"},"planner_test.go")))}u.isMDXComponent=!0}}]);