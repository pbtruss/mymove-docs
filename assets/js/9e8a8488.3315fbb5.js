"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[2942],{3905:function(e,n,t){t.d(n,{Zo:function(){return u},kt:function(){return f}});var o=t(67294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function l(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,o)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?l(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):l(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function i(e,n){if(null==e)return{};var t,o,a=function(e,n){if(null==e)return{};var t,o,a={},l=Object.keys(e);for(o=0;o<l.length;o++)t=l[o],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(o=0;o<l.length;o++)t=l[o],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var s=o.createContext({}),d=function(e){var n=o.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=d(e.components);return o.createElement(s.Provider,{value:n},e.children)},g={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},p=o.forwardRef((function(e,n){var t=e.components,a=e.mdxType,l=e.originalType,s=e.parentName,u=i(e,["components","mdxType","originalType","parentName"]),p=d(t),f=a,h=p["".concat(s,".").concat(f)]||p[f]||g[f]||l;return t?o.createElement(h,r(r({ref:n},u),{},{components:t})):o.createElement(h,r({ref:n},u))}));function f(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var l=t.length,r=new Array(l);r[0]=p;var i={};for(var s in n)hasOwnProperty.call(n,s)&&(i[s]=n[s]);i.originalType=e,i.mdxType="string"==typeof e?e:a,r[1]=i;for(var d=2;d<l;d++)r[d]=t[d];return o.createElement.apply(null,r)}return o.createElement.apply(null,t)}p.displayName="MDXCreateElement"},28332:function(e,n,t){t.r(n),t.d(n,{frontMatter:function(){return i},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return u},default:function(){return p}});var o=t(87462),a=t(63366),l=(t(67294),t(3905)),r=["components"],i={},s=void 0,d={unversionedId:"dev/versioning/Manage-golang-with-asdf",id:"dev/versioning/Manage-golang-with-asdf",isDocsHomePage:!1,title:"Manage-golang-with-asdf",description:"This document describes how we are using asdf and some troubleshooting steps",source:"@site/docs/dev/versioning/Manage-golang-with-asdf.md",sourceDirName:"dev/versioning",slug:"/dev/versioning/Manage-golang-with-asdf",permalink:"/mymove-docs/docs/dev/versioning/Manage-golang-with-asdf",editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/dev/versioning/Manage-golang-with-asdf.md",tags:[],version:"current",frontMatter:{},sidebar:"devSidebar",previous:{title:"How-to-upgrade-Node",permalink:"/mymove-docs/docs/dev/versioning/How-to-upgrade-Node"},next:{title:"Switching-Over-to-Nix",permalink:"/mymove-docs/docs/dev/versioning/Switching-Over-to-Nix"}},u=[{value:"Install asdf",id:"install-asdf",children:[]},{value:"Install golang plugin",id:"install-golang-plugin",children:[]},{value:"Install the version of golang MilMove is using",id:"install-the-version-of-golang-milmove-is-using",children:[]},{value:"Configure global use of golang version",id:"configure-global-use-of-golang-version",children:[]},{value:"Reload your shell",id:"reload-your-shell",children:[]},{value:"Verify install",id:"verify-install",children:[]},{value:"GoLand is looking for GOROOT",id:"goland-is-looking-for-goroot",children:[]},{value:"Missing <code>asdf.sh</code> executable",id:"missing-asdfsh-executable",children:[]},{value:"Compile errors because wrong version of go after upgrading",id:"compile-errors-because-wrong-version-of-go-after-upgrading",children:[]}],g={toc:u};function p(e){var n=e.components,t=(0,a.Z)(e,r);return(0,l.kt)("wrapper",(0,o.Z)({},g,t,{components:n,mdxType:"MDXLayout"}),(0,l.kt)("p",null,"This document describes how we are using asdf and some troubleshooting steps"),(0,l.kt)("h1",{id:"toc"},"TOC"),(0,l.kt)("ul",null,(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#what-is-asdf"},"What is ASDF?")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#why-asdf"},"Why ASDF?")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#why-asdf-global-golang-"},"Why ",(0,l.kt)("inlineCode",{parentName:"a"},"asdf global golang "),"?")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#how-to-get-up-and-running"},"How to get up and running"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#install-asdf"},"Install asdf")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#install-golang-plugin"},"Install golang plugin")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#install-the-version-of-golang-milmove-is-using"},"Install the version of golang MilMove is using")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#configure-global-use-of-golang-version"},"Configure global use of golang version")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#reload-your-shell"},"Reload your shell")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#verify-install"},"Verify install")))),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#troubleshooting"},"Troubleshooting"),(0,l.kt)("ul",{parentName:"li"},(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#goland-is-looking-for-goroot"},"GoLand is looking for GOROOT")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#missing-asdfsh-executable"},"Missing ",(0,l.kt)("inlineCode",{parentName:"a"},"asdf.sh")," executable")),(0,l.kt)("li",{parentName:"ul"},(0,l.kt)("a",{parentName:"li",href:"#compile-errors-because-wrong-version-of-go-after-upgrading"},"Compile errors because wrong version of go after upgrading"))))),(0,l.kt)("h1",{id:"what-is-asdf"},"What is ASDF?"),(0,l.kt)("p",null,"Besides being the home row of the left hand in the qwerty layout it is also a tool to manage runtime versions of multiple different tools. The home page for asdf is at ",(0,l.kt)("a",{parentName:"p",href:"https://asdf-vm.com/"},"https://asdf-vm.com/"),". While they support more than one type of tool we are only using it for golang."),(0,l.kt)("h1",{id:"why-asdf"},"Why ASDF?"),(0,l.kt)("p",null,"To find out more on why asdf was chosen please read ",(0,l.kt)("a",{parentName:"p",href:"https://github.com/transcom/mymove/blob/master/docs/adr/0056-use-asdf-to-manage-golang-versions-in-development.md"},"ADR 0056 - Use asdf to manage golang versoins in development")),(0,l.kt)("h1",{id:"why-asdf-global-golang-version"},"Why ",(0,l.kt)("inlineCode",{parentName:"h1"},"asdf global golang <version>"),"?"),(0,l.kt)("p",null,"We ran into an issue with asdf and pre-commit hooks. During the installation process of the pre-commit hooks ",(0,l.kt)("inlineCode",{parentName:"p"},"golanglint-ci")," requires use of go. Basically the install of ",(0,l.kt)("inlineCode",{parentName:"p"},"golanglint-ci")," happens outside of the milmove directory, which doesn't have ",(0,l.kt)("inlineCode",{parentName:"p"},".tool-versions"),". So it depends on the global version of golang installed. Since this could be via brew, which has a newer version of golang than currently used on MilMove, or any number of other ways we are recommending using ",(0,l.kt)("inlineCode",{parentName:"p"},"asdf global")," config to configure the default for outside the project as well. This is not different than before the ADR 56 because we had been using ",(0,l.kt)("inlineCode",{parentName:"p"},"brew")," to install and pin golang globally on our laptops."),(0,l.kt)("h1",{id:"how-to-get-up-and-running"},"How to get up and running"),(0,l.kt)("h2",{id:"install-asdf"},"Install asdf"),(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"brew install asdf")," to install asdf, then add it to your shell's rc file. See ",(0,l.kt)("a",{parentName:"p",href:"https://asdf-vm.com/#/core-manage-asdf?id=add-to-your-shell"},"Adding to your Shell")," from the asdf documentation."),(0,l.kt)("h2",{id:"install-golang-plugin"},"Install golang plugin"),(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"asdf plugin add golang")," to add the golang plugin. There are other plugins for asdf if you'd like to use it for other projects as well. Also has support for ",(0,l.kt)("inlineCode",{parentName:"p"},"legacy_version_file")," to look for things like ",(0,l.kt)("inlineCode",{parentName:"p"},".node-version")," instead of just ",(0,l.kt)("inlineCode",{parentName:"p"},".tool-versions"),"."),(0,l.kt)("h2",{id:"install-the-version-of-golang-milmove-is-using"},"Install the version of golang MilMove is using"),(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"asdf install")," to install the binary for the currently required version of golang."),(0,l.kt)("h2",{id:"configure-global-use-of-golang-version"},"Configure global use of golang version"),(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"cat .tool-versions")," to output what version of go we should be using"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"\u276f cat .tool-versions\ngolang 1.15.10\n")),(0,l.kt)("p",null,"Then run ",(0,l.kt)("inlineCode",{parentName:"p"},"asdf global golang 1.15.10")),(0,l.kt)("h2",{id:"reload-your-shell"},"Reload your shell"),(0,l.kt)("p",null,"Reload your shell, open a new shell or source your rc file."),(0,l.kt)("h2",{id:"verify-install"},"Verify install"),(0,l.kt)("p",null,"Run ",(0,l.kt)("inlineCode",{parentName:"p"},"asdf current")," and ",(0,l.kt)("inlineCode",{parentName:"p"},"which go")," to verify they point to the right versions. This is also checked by the ",(0,l.kt)("inlineCode",{parentName:"p"},"script/prereqs")," script"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"\u276f asdf current\ngolang          1.15.10          /Users/john/projects/dod/mymove/.tool-versions\n\n\u276f which go\n/Users/john/.asdf/shims/go\n\n\u276f rm .prereqs.stamp\n\u276f make prereqs\nscripts/prereqs\n/usr/local/bin/aws installed.\nbash installed.\n/usr/local/bin/chamber installed.\ndocker installed.\njq installed.\nasdf installed.\n.asdf/shims was found in path\ngo installed.\nyarn installed.\npre-commit installed.\nshellcheck installed.\npsql installed.\nnodenv installed.\n.nodenv/shims was found in path\nnode installed.\npkcs11-tool installed.\npkcs15-tool installed.\ncircleci installed.\ndirenv installed.\nentr installed.\naws-vault installed.\nwatchman installed.\nOK: all prereqs found\n")),(0,l.kt)("h1",{id:"troubleshooting"},"Troubleshooting"),(0,l.kt)("h2",{id:"goland-is-looking-for-goroot"},"GoLand is looking for GOROOT"),(0,l.kt)("p",null,"Another issue GoLand users can run into with asdf is with GOROOT. Goland expects GOROOT to be set but it may be unclear what it should be set to. You can easily find the value by running ",(0,l.kt)("inlineCode",{parentName:"p"},"asdf which go")," and then set that appropriately for your shell. Not upgrading versions will require this to change unless you can set GOROOT to the output directory of ",(0,l.kt)("inlineCode",{parentName:"p"},"asdf which go"),", for example "),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"export GOROOT=~/.asdf/installs/golang/1.15.10/go\n")),(0,l.kt)("h2",{id:"missing-asdfsh-executable"},"Missing ",(0,l.kt)("inlineCode",{parentName:"h2"},"asdf.sh")," executable"),(0,l.kt)("p",null,"Some users have run into an issue with not being able run ",(0,l.kt)("inlineCode",{parentName:"p"},"asdf"),". This is fixed by adding the following line to the ",(0,l.kt)("inlineCode",{parentName:"p"},".bash_profile")," file:"),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},"source /usr/local/opt/asdf/asdf.sh\n")),(0,l.kt)("p",null,"then run ",(0,l.kt)("inlineCode",{parentName:"p"},"source ~/.bash_profile")," in the terminal to reload."),(0,l.kt)("h2",{id:"compile-errors-because-wrong-version-of-go-after-upgrading"},"Compile errors because wrong version of go after upgrading"),(0,l.kt)("p",null,"If you are getting can't compile because library was compiled for ",(0,l.kt)("inlineCode",{parentName:"p"},"old version of go")," vs ",(0,l.kt)("inlineCode",{parentName:"p"},"current version of go"),". You probably should exit your shell and open a new one. Also ensure the below are in your shell's rc file."),(0,l.kt)("pre",null,(0,l.kt)("code",{parentName:"pre",className:"language-sh"},'source /usr/local/opt/asdf/asdf.sh\n\nexport GOPATH=$(go env GOPATH)\nexport PATH="$PATH:$(go env GOPATH)/bin"\n')))}p.isMDXComponent=!0}}]);