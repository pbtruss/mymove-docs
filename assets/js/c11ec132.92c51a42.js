"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[7521],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>p});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),d=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(l.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=d(n),p=r,f=m["".concat(l,".").concat(p)]||m[p]||c[p]||o;return n?a.createElement(f,i(i({ref:t},u),{},{components:n})):a.createElement(f,i({ref:t},u))}));function p(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:r,i[1]=s;for(var d=2;d<o;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},16419:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>i,default:()=>c,frontMatter:()=>o,metadata:()=>s,toc:()=>d});var a=n(87462),r=(n(67294),n(3905));const o={sidebar_position:16},i="Roles and Permissions",s={unversionedId:"backend/guides/roles-and-permissions",id:"backend/guides/roles-and-permissions",title:"Roles and Permissions",description:"Background",source:"@site/docs/backend/guides/roles-and-permissions.md",sourceDirName:"backend/guides",slug:"/backend/guides/roles-and-permissions",permalink:"/mymove-docs/docs/backend/guides/roles-and-permissions",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/backend/guides/roles-and-permissions.md",tags:[],version:"current",sidebarPosition:16,frontMatter:{sidebar_position:16},sidebar:"backendSidebar",previous:{title:"Session management",permalink:"/mymove-docs/docs/backend/guides/session-management"},next:{title:"Switching over to Nix",permalink:"/mymove-docs/docs/backend/guides/switching-over-to-nix"}},l={},d=[{value:"Background",id:"background",level:2},{value:"Rules and Definitions",id:"rules-and-definitions",level:3},{value:"Implementation Details",id:"implementation-details",level:3},{value:"Outstanding Work Left To Do",id:"outstanding-work-left-to-do",level:3},{value:"OWASP Recommendations",id:"owasp-recommendations",level:3},{value:"Resources",id:"resources",level:3}],u={toc:d};function c(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"roles-and-permissions"},"Roles and Permissions"),(0,r.kt)("h2",{id:"background"},"Background"),(0,r.kt)("p",null,"MilMove follows the OWASP recommendations for Role Based Access Control for requests. Below you will find details on the implementation as well as links to references and resources used in the construction of this middleware. "),(0,r.kt)("h3",{id:"rules-and-definitions"},"Rules and Definitions"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Roles")," "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Are defined by our existing user groups e.g. TIO, TOO, Prime etc.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Access")," "),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Is evaluated based on the permissions granted to a user's role. ")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Permissions")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Are ",(0,r.kt)("strong",{parentName:"li"},"additive"),", meaning if a user has multiple roles, they will have permissions from all roles.  "),(0,r.kt)("li",{parentName:"ul"},"composed of an ",(0,r.kt)("inlineCode",{parentName:"li"},"action")," and an ",(0,r.kt)("inlineCode",{parentName:"li"},"object"),". Actions are mapped to CRUD actions, and objects map to database level objects.",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"update.move")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"create.serviceItem")," "))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"context")," comes from the route they are defined upon. ")),(0,r.kt)("h3",{id:"implementation-details"},"Implementation Details"),(0,r.kt)("p",null,"In order to implement the above rules MyMove has permissions middleware which can be set on the API router in ",(0,r.kt)("inlineCode",{parentName:"p"},"cmd/milmove/serve.go")," and will then run at the front of request processing. For more details on how Go-Swagger middleware works refer to the resources section below."),(0,r.kt)("p",null,"Permissions should be added to a swagger route on the operation level of the route (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"get"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"post"),", ",(0,r.kt)("inlineCode",{parentName:"p"},"patch"),") with the ",(0,r.kt)("inlineCode",{parentName:"p"},"x-permissions")," keyword. Multiple permissions can be defined and a user must meet all of these in order to be granted access. "),(0,r.kt)("p",null,"The middleware checks the permissions listed on the route against the user's roles, and the permissions allotted to those roles. Permissions are ",(0,r.kt)("strong",{parentName:"p"},"addititve")," so if a user has more than one role, they will have the permissions from all roles. If they are missing any of the permissions required for a route operation access will be denied and logged. "),(0,r.kt)("h3",{id:"outstanding-work-left-to-do"},"Outstanding Work Left To Do"),(0,r.kt)("p",null,"This is still a work in progress - so we expect this model to continue to evolve. Outstanding items to be figured out include:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dp3.atlassian.net/browse/MB-12738"},"Determine a datastore for permissions")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://dp3.atlassian.net/browse/MB-12739"},"Cleanup manual checks"))),(0,r.kt)("h3",{id:"owasp-recommendations"},"OWASP Recommendations"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Role Based Access Control - RBAC - model for controlling access to resources where permitted actions are identified with roles rather than with individual identities")),(0,r.kt)("p",null,"Principles of access control design"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Design AC thoroughly up front",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"may start simple but can grow in to a complex and feature-heavy security control, ensure that functionality will allow for customization and future requirements"))),(0,r.kt)("li",{parentName:"ul"},"Force all requests to go through AC checks"),(0,r.kt)("li",{parentName:"ul"},"Deny by default - if a request is not specifically allowed it is denied ",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"if an error is thrown by application code AC should always be denied"),(0,r.kt)("li",{parentName:"ul"},"when a new account is created (via admin or user sign up) that should have minimal or no access by default until configured"),(0,r.kt)("li",{parentName:"ul"},"when a new feature is added all users should be denied access until it is properly configured"))),(0,r.kt)("li",{parentName:"ul"},"Principle of least privilege - all users should have the least amount of access possible",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"be wary of systems that do not provide granular access control configuration capabilities"))),(0,r.kt)("li",{parentName:"ul"},"Don\u2019t hardcode rules",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"it\u2019s fragile - can be easy to create incorrect or missing role checks"),(0,r.kt)("li",{parentName:"ul"},"does not allow for multi-tenancy, extreme measures like forked code or added checks for each customer will be required for have different rules for different customers"),(0,r.kt)("li",{parentName:"ul"},"does not allow for data-specific or horizontal access control rules"),(0,r.kt)("li",{parentName:"ul"},"can make it difficult to audit or verify the overall application access control policy"),(0,r.kt)("li",{parentName:"ul"},"instead use attribute or feature-based access control checks "))),(0,r.kt)("li",{parentName:"ul"},"Log all access control events",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"all failures should be logged as they can be indicative of a malicious user probing the app for vulnerabilities")))),(0,r.kt)("h3",{id:"resources"},"Resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/transcom/mymove/blob/c90ae337459b0dafaede81e8b684f59bf5aa1465/docs/adr/0040-role-base-authorization.md"},"ADR-040 -> using swagger for RBAC middleware")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://github.com/transcom/mymove/pull/8673"},"Initial PR for permissions middleware implementation")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://swagger.io/docs/specification/2-0/authentication/"},"How auth works in swagger")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://goswagger.io/tutorial/composed-auth/"},"Composed auth in swagger")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://goswagger.io/use/middleware.html"},"Using Middleware in Go-Swagger")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://www.alexedwards.net/blog/making-and-using-middleware"},"Making and using middleware in Go")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://eli.thegreenplace.net/2021/rest-servers-in-go-part-4-using-openapi-and-swagger/"},"How Open-API, Swagger and Go work together")," s")))}c.isMDXComponent=!0}}]);