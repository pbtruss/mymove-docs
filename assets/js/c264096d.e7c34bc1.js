"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[6480],{3905:function(e,t,n){n.d(t,{Zo:function(){return c},kt:function(){return m}});var o=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,r=function(e,t){if(null==e)return{};var n,o,r={},a=Object.keys(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=o.createContext({}),d=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},c=function(e){var t=d(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},p=o.forwardRef((function(e,t){var n=e.components,r=e.mdxType,a=e.originalType,s=e.parentName,c=l(e,["components","mdxType","originalType","parentName"]),p=d(n),m=r,f=p["".concat(s,".").concat(m)]||p[m]||u[m]||a;return n?o.createElement(f,i(i({ref:t},c),{},{components:n})):o.createElement(f,i({ref:t},c))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var a=n.length,i=new Array(a);i[0]=p;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<a;d++)i[d]=n[d];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}p.displayName="MDXCreateElement"},29192:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return d},toc:function(){return c},default:function(){return p}});var o=n(87462),r=n(63366),a=(n(67294),n(3905)),i=["components"],l={},s="How to Soft Delete",d={unversionedId:"dev/contributing/backend/soft-delete",id:"dev/contributing/backend/soft-delete",isDocsHomePage:!1,title:"How to Soft Delete",description:"Due to our contractual obligations with the federal government, we must be able to access deleted data even several years after it\u2019s been used in the system. For this reason, MilMove is shifting away from hard deleting data and adopting the practice to soft delete instead. Soft delete functionality has not yet been implemented throughout the entire codebase but it is expected to be the sole deletion method moving forward.",source:"@site/docs/dev/contributing/backend/soft-delete.md",sourceDirName:"dev/contributing/backend",slug:"/dev/contributing/backend/soft-delete",permalink:"/mymove-docs/docs/dev/contributing/backend/soft-delete",editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/dev/contributing/backend/soft-delete.md",tags:[],version:"current",frontMatter:{},sidebar:"devSidebar",previous:{title:"Validation in Service Objects",permalink:"/mymove-docs/docs/dev/contributing/backend/service-validation"},next:{title:"What Is Optimistic Locking?",permalink:"/mymove-docs/docs/dev/contributing/backend/use-optimistic-locking"}},c=[{value:"How Soft Delete Works",id:"how-soft-delete-works",children:[]},{value:"Prerequisites for Soft Delete",id:"prerequisites-for-soft-delete",children:[]},{value:"Using Soft Delete",id:"using-soft-delete",children:[]}],u={toc:c};function p(e){var t=e.components,n=(0,r.Z)(e,i);return(0,a.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"how-to-soft-delete"},"How to Soft Delete"),(0,a.kt)("p",null,"Due to our contractual obligations with the federal government, we must be able to access deleted data even several years after it\u2019s been used in the system. For this reason, MilMove is shifting away from hard deleting data and adopting the practice to soft delete instead. Soft delete functionality has not yet been implemented throughout the entire codebase but it is expected to be the sole deletion method moving forward."),(0,a.kt)("p",null,"Please note that soft delete is to be treated like a hard delete in the regard that the process should never be reversed or that data can be 'un-deleted'."),(0,a.kt)("h2",{id:"how-soft-delete-works"},"How Soft Delete Works"),(0,a.kt)("p",null,"MilMove's implementation of soft delete takes in a model, sets a time stamp to its ",(0,a.kt)("inlineCode",{parentName:"p"},"DeletedAt")," field, before cascading down to its children and repeating the process until there are no longer children to 'delete'."),(0,a.kt)("h2",{id:"prerequisites-for-soft-delete"},"Prerequisites for Soft Delete"),(0,a.kt)("p",null,"To use soft delete, a model and its children (or foreign key associations) must possess a ",(0,a.kt)("inlineCode",{parentName:"p"},"DeletedAt")," field that corresponds to the ",(0,a.kt)("inlineCode",{parentName:"p"},"deleted_at")," column of their table within the database."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'type ExampleModel struct {\n    ...\n    DeletedAt   *time.Time  `db:"deleted_at"`\n\n}\n')),(0,a.kt)("p",null,"If this has not been done, one must ",(0,a.kt)("a",{parentName:"p",href:"migrate-the-database.md"},"create a migration")," to make these changes."),(0,a.kt)("p",null,"Furthermore, any queries to fetch the model must exclude those that have been 'soft deleted'."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'func FetchExampleModel(ctx context.Context, db *pop.Connection, session * auth.Session, id uuid.UUID) (ExampleModel, error) {\n    var exampleModel ExampleModel\n    err := db.Q().Where("example_models.deleted_at is null").Eager().Find(&exampleModel, id)\n    ...\n}\n')),(0,a.kt)("h2",{id:"using-soft-delete"},"Using Soft Delete"),(0,a.kt)("p",null,"In order to use MilMove's soft delete method, one must import the following package"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},'package models\n\nimport (\n    "github.com/transcom/mymove/pkg/db/utilities"\n)\n')),(0,a.kt)("p",null,"It is recommended that any use of soft delete be wrapped in a transaction. This is to rollback the deletion should any error arise."),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-go"},"func DeleteExampleModel(db *pop.Connection, exampleModel *ExampleModel) error {\n    return db.Transaction(func(db *pop.Connection)) error {\n        return utilities.SoftDestroy(db, exampleModel)\n    }\n}\n")))}p.isMDXComponent=!0}}]);