"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[8229],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return v}});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var c=a.createContext({}),s=function(e){var t=a.useContext(c),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},p=function(e){var t=s(e.components);return a.createElement(c.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,i=e.originalType,c=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),u=s(n),v=r,m=u["".concat(c,".").concat(v)]||u[v]||d[v]||i;return n?a.createElement(m,o(o({ref:t},p),{},{components:n})):a.createElement(m,o({ref:t},p))}));function v(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=n.length,o=new Array(i);o[0]=u;var l={};for(var c in t)hasOwnProperty.call(t,c)&&(l[c]=t[c]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var s=2;s<i;s++)o[s]=n[s];return a.createElement.apply(null,o)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},19772:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return c},metadata:function(){return s},toc:function(){return p},default:function(){return u}});var a=n(87462),r=n(63366),i=(n(67294),n(3905)),o=["components"],l={},c="How to Access a Global Application Variable",s={unversionedId:"dev/contributing/backend/access-global-variables",id:"dev/contributing/backend/access-global-variables",isDocsHomePage:!1,title:"How to Access a Global Application Variable",description:"Overview",source:"@site/docs/dev/contributing/backend/access-global-variables.md",sourceDirName:"dev/contributing/backend",slug:"/dev/contributing/backend/access-global-variables",permalink:"/mymove-docs/docs/dev/contributing/backend/access-global-variables",editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/dev/contributing/backend/access-global-variables.md",tags:[],version:"current",frontMatter:{},sidebar:"devSidebar",previous:{title:"WIP-Server-side-validation",permalink:"/mymove-docs/docs/dev/contributing/backend/WIP-Server-side-validation"},next:{title:"How to Add Application Logging",permalink:"/mymove-docs/docs/dev/contributing/backend/add-application-logging"}},p=[{value:"Overview",id:"overview",children:[]},{value:"Why we do it this way",id:"why-we-do-it-this-way",children:[]},{value:"Getting Environment Variables",id:"getting-environment-variables",children:[]},{value:"Setting up global variables in the Handler Context",id:"setting-up-global-variables-in-the-handler-context",children:[]}],d={toc:p};function u(e){var t=e.components,n=(0,r.Z)(e,o);return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"how-to-access-a-global-application-variable"},"How to Access a Global Application Variable"),(0,i.kt)("h2",{id:"overview"},"Overview"),(0,i.kt)("p",null,"In this project, we access application variables (environment variables or other variables we set for the application) by adding them to the handler context.  Through the context we pass the variables to the functions that require them."),(0,i.kt)("h2",{id:"why-we-do-it-this-way"},"Why we do it this way"),(0,i.kt)("p",null,"Environment variables should only be accessed in the main ",(0,i.kt)("inlineCode",{parentName:"p"},"serve.go")," file and turned into real variables for passing around at that point. Accessing environment vars in other parts of the code increases the scope of our problems if there is something wrong with the environment vars. Also it increases problems with security if people are using the ",(0,i.kt)("inlineCode",{parentName:"p"},"os")," package directly to get them instead of using the ",(0,i.kt)("inlineCode",{parentName:"p"},"spf13/viper")," package which reads both environment vars and command line flags."),(0,i.kt)("p",null,"We use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/spf13/viper"},"spf13/viper")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/spf13/pflag"},"spf13/pflags")," to access environment variables today. It replaces using the ",(0,i.kt)("inlineCode",{parentName:"p"},"os")," package and the ",(0,i.kt)("inlineCode",{parentName:"p"},"flag")," package because it does both. The pattern is the 12-factor-app pattern."),(0,i.kt)("h2",{id:"getting-environment-variables"},"Getting Environment Variables"),(0,i.kt)("p",null,"We use command line flags to get the environment variables. The flags are set in the ",(0,i.kt)("inlineCode",{parentName:"p"},"cli")," package.  Viper can take the flag and gets the value associated with that flag.  For example:"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"dbEnv := v.GetString(cli.DbEnvFlag)")," returns the database environment name"),(0,i.kt)("p",null,(0,i.kt)("inlineCode",{parentName:"p"},"loginGovSecretKey := v.GetString(cli.LoginGovSecretKeyFlag))")," grabs the ",(0,i.kt)("inlineCode",{parentName:"p"},"LOGIN_GOV_SECRET_KEY")," from the ",(0,i.kt)("inlineCode",{parentName:"p"},".envrc")),(0,i.kt)("h2",{id:"setting-up-global-variables-in-the-handler-context"},"Setting up global variables in the Handler Context"),(0,i.kt)("p",null,"To add an application variable to the handler context, we create essentially a getter and setter in the handler context.\n(Ex. ",(0,i.kt)("inlineCode",{parentName:"p"},"SetUseSecureCookie")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"UseSecureCookie"),")\nFollow the pattern in ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/transcom/mymove/blob/master/pkg/handlers/contexts.go"},"pkg/handlers/contexts.go")),(0,i.kt)("p",null,"Then, in the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/transcom/mymove/blob/master/cmd/milmove/serve.go"},"cmd/milmove/serve.go")," file, in the function ",(0,i.kt)("inlineCode",{parentName:"p"},"serveFunction")," set the value using the setter.\nFor example:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'dbEnv := v.GetString(cli.DbEnvFlag)\nisDevOrTest := dbEnv == "development" || dbEnv == "test"\nuseSecureCookie := !isDevOrTest\nhandlerContext.SetUseSecureCookie(useSecureCookie)\n')),(0,i.kt)("p",null,"In your handler, you should now be able to access the value through the handler context by calling the getter (ex. ",(0,i.kt)("inlineCode",{parentName:"p"},"h.HandlerContext.UseSecureCookie()"),")"))}u.isMDXComponent=!0}}]);