"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[9095],{3905:(e,t,n)=>{n.d(t,{Zo:()=>c,kt:()=>h});var i=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);t&&(i=i.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,i)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function a(e,t){if(null==e)return{};var n,i,r=function(e,t){if(null==e)return{};var n,i,r={},l=Object.keys(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(e);for(i=0;i<l.length;i++)n=l[i],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=i.createContext({}),u=function(e){var t=i.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},c=function(e){var t=u(e.components);return i.createElement(s.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return i.createElement(i.Fragment,{},t)}},p=i.forwardRef((function(e,t){var n=e.components,r=e.mdxType,l=e.originalType,s=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),p=u(n),h=r,m=p["".concat(s,".").concat(h)]||p[h]||d[h]||l;return n?i.createElement(m,o(o({ref:t},c),{},{components:n})):i.createElement(m,o({ref:t},c))}));function h(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var l=n.length,o=new Array(l);o[0]=p;var a={};for(var s in t)hasOwnProperty.call(t,s)&&(a[s]=t[s]);a.originalType=e,a.mdxType="string"==typeof e?e:r,o[1]=a;for(var u=2;u<l;u++)o[u]=n[u];return i.createElement.apply(null,o)}return i.createElement.apply(null,n)}p.displayName="MDXCreateElement"},21516:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>d,frontMatter:()=>l,metadata:()=>a,toc:()=>u});var i=n(87462),r=(n(67294),n(3905));const l={title:"0047 Use CircleCI to build only Pull Requests and master"},o="Use CircleCI to build only Pull Requests and master",a={unversionedId:"adrs/build-only-pull-requests-in-circleci",id:"adrs/build-only-pull-requests-in-circleci",title:"0047 Use CircleCI to build only Pull Requests and master",description:"Currently our CircleCI costs are very high, well over the initial expected budget. By default CircleCI builds every branch regardless of if it has a Pull Request (PR) or not. Given the size of the MilMove team and our typical pattern of creating branches in the main repo this results in a large number of builds. The builds are also triggered every time a branch changes, which can be quite frequent on active development branches.",source:"@site/docs/adrs/0047-build-only-pull-requests-in-circleci.md",sourceDirName:"adrs",slug:"/adrs/build-only-pull-requests-in-circleci",permalink:"/mymove-docs/docs/adrs/build-only-pull-requests-in-circleci",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/adrs/0047-build-only-pull-requests-in-circleci.md",tags:[],version:"current",sidebarPosition:47,frontMatter:{title:"0047 Use CircleCI to build only Pull Requests and master"},sidebar:"adrsSidebar",previous:{title:"0046 Use nodenv to manage Node versions in development",permalink:"/mymove-docs/docs/adrs/use-nodenv"},next:{title:"0048 Use a consistent file structure for front-end code",permalink:"/mymove-docs/docs/adrs/frontend-file-org"}},s={},u=[{value:"Considered Alternatives",id:"considered-alternatives",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"How do we undo this",id:"how-do-we-undo-this",level:3},{value:"Pros and Cons of the Alternatives",id:"pros-and-cons-of-the-alternatives",level:2},{value:"Do nothing, keep the default settings for CircleCI",id:"do-nothing-keep-the-default-settings-for-circleci",level:3},{value:"Switch on the CircleCI option to only build PRs and our default branch (master)",id:"switch-on-the-circleci-option-to-only-build-prs-and-our-default-branch-master",level:3},{value:"Keep building all branches and review build pipeline",id:"keep-building-all-branches-and-review-build-pipeline",level:3}],c={toc:u};function d(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,i.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"use-circleci-to-build-only-pull-requests-and-master"},"Use CircleCI to build only Pull Requests and master"),(0,r.kt)("p",null,"Currently our CircleCI costs are very high, well over the initial expected budget. By default CircleCI builds every branch regardless of if it has a Pull Request (PR) or not. Given the size of the MilMove team and our typical pattern of creating branches in the main repo this results in a large number of builds. The builds are also triggered every time a branch changes, which can be quite frequent on active development branches."),(0,r.kt)("h2",{id:"considered-alternatives"},"Considered Alternatives"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Do nothing, keep the default settings for CircleCI"),(0,r.kt)("li",{parentName:"ul"},"Switch on the CircleCI option to only build PRs and our default branch (master)"),(0,r.kt)("li",{parentName:"ul"},"Keep building all branches and review build pipeline")),(0,r.kt)("h2",{id:"decision-outcome"},"Decision Outcome"),(0,r.kt)("p",null,(0,r.kt)("em",{parentName:"p"},"Chosen Alternative:")," Switch on the CircleCI option to only build PRs and our default branch (master)A"),(0,r.kt)("p",null,"Once accepted this switch ",(0,r.kt)("inlineCode",{parentName:"p"},"CircleCI -> Project Settings -> Advanced -> Only build pull requests")," should be enabled."),(0,r.kt)("h3",{id:"how-do-we-undo-this"},"How do we undo this"),(0,r.kt)("p",null,"We turn the ",(0,r.kt)("inlineCode",{parentName:"p"},"CircleCI -> Project Settings -> Advanced -> Only build pull requests")," option off."),(0,r.kt)("h2",{id:"pros-and-cons-of-the-alternatives"},"Pros and Cons of the Alternatives"),(0,r.kt)("h3",{id:"do-nothing-keep-the-default-settings-for-circleci"},"Do nothing, keep the default settings for CircleCI"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"+")," Easiest to do nothing"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-")," Costs of CircleCI continue to grow"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-")," Building all branches will continue building even branches that are not ready for review")),(0,r.kt)("h3",{id:"switch-on-the-circleci-option-to-only-build-prs-and-our-default-branch-master"},"Switch on the CircleCI option to only build PRs and our default branch (master)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"+")," Easy to implement, just a project setting in CircleCI"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"+")," Should reduce our CircleCI costs significantly by only building PR branches"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"+")," CircleCI usage reduction will buy us time before having to review all stages of the pipeline"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"+")," Encourage people to push more often not just when ready for review"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-")," Lose the ability to have our branches run in CircleCI without creating a PR")),(0,r.kt)("h3",{id:"keep-building-all-branches-and-review-build-pipeline"},"Keep building all branches and review build pipeline"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"+")," Review of the pipeline could lead to pipeline efficiencies"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-")," Very time consuming to review"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"-")," Still builds every branch on every commit to each branch, even without a PR")))}d.isMDXComponent=!0}}]);