"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[3238],{3905:function(e,t,n){n.d(t,{Zo:function(){return p},kt:function(){return h}});var o=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,o,a=function(e,t){if(null==e)return{};var n,o,a={},r=Object.keys(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(o=0;o<r.length;o++)n=r[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var s=o.createContext({}),c=function(e){var t=o.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},p=function(e){var t=c(e.components);return o.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return o.createElement(o.Fragment,{},t)}},d=o.forwardRef((function(e,t){var n=e.components,a=e.mdxType,r=e.originalType,s=e.parentName,p=l(e,["components","mdxType","originalType","parentName"]),d=c(n),h=a,m=d["".concat(s,".").concat(h)]||d[h]||u[h]||r;return n?o.createElement(m,i(i({ref:t},p),{},{components:n})):o.createElement(m,i({ref:t},p))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var r=n.length,i=new Array(r);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:a,i[1]=l;for(var c=2;c<r;c++)i[c]=n[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,n)}d.displayName="MDXCreateElement"},7555:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return l},contentTitle:function(){return s},metadata:function(){return c},toc:function(){return p},default:function(){return d}});var o=n(7462),a=n(3366),r=(n(7294),n(3905)),i=["components"],l={},s="Backend Structure",c={unversionedId:"old-wiki/Backend-Structure",id:"old-wiki/Backend-Structure",isDocsHomePage:!1,title:"Backend Structure",description:"...",source:"@site/docs/old-wiki/Backend-Structure.md",sourceDirName:"old-wiki",slug:"/old-wiki/Backend-Structure",permalink:"/docs/old-wiki/Backend-Structure",editUrl:"https://github.com/facebook/docusaurus/edit/main/website/docs/old-wiki/Backend-Structure.md",tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"Backend Programming Guide",permalink:"/docs/old-wiki/Backend-Programming-Guide"},next:{title:"How To Backup and Restore the Development Database",permalink:"/docs/old-wiki/Backup-and-Restore-Dev-Database"}},p=[],u={toc:p};function d(e){var t=e.components,n=(0,a.Z)(e,i);return(0,r.kt)("wrapper",(0,o.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"backend-structure"},"Backend Structure"),(0,r.kt)("p",null,"..."),(0,r.kt)("p",null,"So what is a server? You can google this question and get loads of dense, complicated answers back. But practically - what is it? What is our MilMove server and how do we work with it?"),(0,r.kt)("p",null,'At the lowest level, our server is a Go script. We run a Go command that executes a process with multiple concurrent channels that "listen" for requests to our APIs. (TODO: Add a link to the Go concurrency exercise in A Tour to Go in case folks what to learn more about concurrency) This same script also exits the server. Basically, we run one command for a really long time to serve up our MilMove APIs.'),(0,r.kt)("p",null,"This command is in ",(0,r.kt)("inlineCode",{parentName:"p"},"cmd/milmove/serve.go"),". This file contains the entire lifecycle of our server. We're not going to change this very often, so although it's nice to know where to find it, you'll rarely have to go into this file during your day-to-day."),(0,r.kt)("p",null,"Naturally, this command doesn't handle all of our backend logic. We store the bulk of our server code elsewhere, and the ",(0,r.kt)("inlineCode",{parentName:"p"},"serve.go")," file simply references it at the right times. The rest of our backend code is in the ",(0,r.kt)("inlineCode",{parentName:"p"},"pkg/")," folder. There are some, ",(0,r.kt)("em",{parentName:"p"},"small")," exceptions, but any backend logic should be found in here. ",(0,r.kt)("inlineCode",{parentName:"p"},"pkg/")," is a backend developer's homebase."),(0,r.kt)("p",null,'NOTE: A lot of concepts in the backend have shared terminology. We have the concept of an "endpoint," but it can be called different things depending on which part of the stack you\'re in. For example, and "endpoint" in the API YAML file actually goes under the ',(0,r.kt)("inlineCode",{parentName:"p"},"paths:"),' category. So "endpoint" = "path" in this context.'),(0,r.kt)("p",null,"In the YAML file, we also have a property on each path called ",(0,r.kt)("inlineCode",{parentName:"p"},"operationId:"),'. This is the unique name for your endpoint, or "path," or "operation." So now "endpoint" = "path" = "operation."'),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"gen/")," - the generated Swagger code. No development happens here, but this is where any changes to the API YAML spec will be reflected"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"handlers/"),' - contains our receiving functions for all of our endpoints. We call them "handler functions." Each endpoint (or path or operation, as mentioned above) will have a distinct handler function.'),(0,r.kt)("p",null,"So how do you find the handler function for the endpoint you're looking at?"),(0,r.kt)("p",null,"Within ",(0,r.kt)("inlineCode",{parentName:"p"},"handlers/"),", each API file will have its own subpackage. So the ",(0,r.kt)("inlineCode",{parentName:"p"},"ghc.yaml")," API file will have a package called ",(0,r.kt)("inlineCode",{parentName:"p"},"ghcapi/"),". See below:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"handlers/\n\u251c\u2500\u2500 ghcapi/\n\u251c\u2500\u2500 ...\n")),(0,r.kt)("p",null,"Now go back to your API definition in the YAML file. You should see a ",(0,r.kt)("inlineCode",{parentName:"p"},"tags:")," key. It will look like:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-yaml"},"/mto-shipments:  \n  post:  \n    summary: createMTOShipment  \n    description: |  \n      ...\n    consumes:  \n      - application/json  \n    produces:  \n      - application/json  \n    operationId: createMTOShipment  \n    tags:  \n      - mtoShipment\n")),(0,r.kt)("p",null,"Here we see the tag ",(0,r.kt)("inlineCode",{parentName:"p"},"mtoShipment"),". This will correspond directly with a Go file within the ",(0,r.kt)("inlineCode",{parentName:"p"},"internalapi/")," package in the backend. So now you know you're looking for the ",(0,r.kt)("inlineCode",{parentName:"p"},"mto_shipment.go")," file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"handlers/\n\u251c\u2500\u2500 ghcapi/\n\u2502   \u251c\u2500\u2500 mto_shipment.go\n\u2502   \u251c\u2500\u2500 ...\n\u251c\u2500\u2500 ...\n")),(0,r.kt)("p",null,"Back in the API definition again, this time look for the ",(0,r.kt)("inlineCode",{parentName:"p"},"operationId:")," key. If you look at the example above, you can see we have the value ",(0,r.kt)("inlineCode",{parentName:"p"},"createMTOShipment")," as our operation ID for this endpoint."),(0,r.kt)("p",null,"Within the ",(0,r.kt)("inlineCode",{parentName:"p"},"mto_shipment.go")," file, we now know we're looking for a struct called ",(0,r.kt)("inlineCode",{parentName:"p"},"CreateMTOShipmentHandler"),". This struct will have an associated ",(0,r.kt)("inlineCode",{parentName:"p"},"Handle()")," function. Almost all of the logic (save for auths, and some validation in the generated Swagger files) for your the action your endpoint represents is executed from this function. "),(0,r.kt)("p",null,'Although this function executes the logic for this endpoint\'s action, it generally calls other functions to complete the bulk of the business logic. In the MilMove codebase, we have a concept of "services." Services are shared business logic that we use across all of our APIs - see below (TODO LINK) for a more in-depth explanation.'),(0,r.kt)("p",null,"In the struct for the handler (",(0,r.kt)("inlineCode",{parentName:"p"},"CreateMTOShipmentHandler")," in this example), you'll see that some services are defined ... "),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"services/"),' - contains the code for our "service objects." Service objects, or services, are utility functions that access the database. Generally, no other part of the codebase should be directly accessing the database (although there are always exceptions to any rule).'),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"models/")," - NOTE: explain the difference between models and database access. Explain the role models serve in the ORM."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"testdatagen/")," - NOTE: kind of an aside - uses the models to make test data in test database (but could work in any DB...)"),(0,r.kt)("p",null,"The other top-level packages in the backend are for niche processes that most folks won't interact with. Your day-to-day will be in these four folders (not including ",(0,r.kt)("inlineCode",{parentName:"p"},"gen/")," since those are generated files)."),(0,r.kt)("p",null,"NOTE: Middleware... If we have a comprehensive guide, it might be:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Server/Backend Introduction",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Day-to-Day Overview"),(0,r.kt)("li",{parentName:"ul"},"Guide to Middleware"),(0,r.kt)("li",{parentName:"ul"},"In depth on Service Objects"),(0,r.kt)("li",{parentName:"ul"},"Models (and Database interactions?)"),(0,r.kt)("li",{parentName:"ul"},"The Pricer/Rate engine?")))),(0,r.kt)("p",null,'In docusaurus, have a "Guides" section for tutorials and the like. Point new folks here.'))}d.isMDXComponent=!0}}]);