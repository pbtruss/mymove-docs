"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[4586],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var s=a.createContext({}),c=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=c(e.components);return a.createElement(s.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},h=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),h=c(n),u=o,m=h["".concat(s,".").concat(u)]||h[u]||p[u]||i;return n?a.createElement(m,r(r({ref:t},d),{},{components:n})):a.createElement(m,r({ref:t},d))}));function u(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=h;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:o,r[1]=l;for(var c=2;c<i;c++)r[c]=n[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}h.displayName="MDXCreateElement"},4418:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>p,frontMatter:()=>i,metadata:()=>l,toc:()=>c});var a=n(87462),o=(n(67294),n(3905));const i={sidebar_position:2},r="Backend Structure",l={unversionedId:"backend/guides/backend-structure",id:"backend/guides/backend-structure",title:"Backend Structure",description:"This article provides a high-level overview of the MilMove backend. It is intended for folks who are brand new to the project and need some guidance to navigate through the complexity and clutter in our codebase. It is not intended to be an in-depth analysis of why our backend is the way it is.",source:"@site/docs/backend/guides/backend-structure.md",sourceDirName:"backend/guides",slug:"/backend/guides/backend-structure",permalink:"/mymove-docs/docs/backend/guides/backend-structure",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/backend/guides/backend-structure.md",tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"backendSidebar",previous:{title:"Usage",permalink:"/mymove-docs/docs/backend/guides/service-objects/usage"},next:{title:"Adding ShipmentLineItem records to the 400ng table (tariff400ng_items)",permalink:"/mymove-docs/docs/backend/guides/tariff400ng_items-update-data"}},s={},c=[{value:"The Server",id:"the-server",level:2},{value:"The Backend: <code>pkg/</code>",id:"the-backend-pkg",level:2}],d={toc:c};function p(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"backend-structure"},"Backend Structure"),(0,o.kt)("p",null,"This article provides a high-level overview of the MilMove backend. It is intended for folks who are brand new to the project and need some guidance to navigate through the complexity and clutter in our codebase. It is not intended to be an in-depth analysis of ",(0,o.kt)("em",{parentName:"p"},"why")," our backend is the way it is."),(0,o.kt)("h2",{id:"the-server"},"The Server"),(0,o.kt)("p",null,"So what is a server? You can google this question and get loads of dense, complicated answers back. But practically, what is our MilMove server and how do we work with it?"),(0,o.kt)("p",null,'At the lowest level, our server is a Go script. We run a Go command that executes a process with multiple concurrent channels that "listen" for requests to our APIs. (TODO: Add a link to the Go concurrency exercise in A Tour to Go in case folks what to learn more about concurrency) This same script also exits the server. Basically, we run one command for a really long time to serve up our MilMove APIs.'),(0,o.kt)("p",null,"This command is in ",(0,o.kt)("inlineCode",{parentName:"p"},"cmd/milmove/serve.go"),". This file contains the entire lifecycle of our server. We're not going to change this very often, so although it's nice to know where to find it, you'll rarely have to go into this file during your day-to-day."),(0,o.kt)("p",null,"Naturally, this command doesn't handle all of our backend logic. We store the\nbulk of our server code elsewhere, and the ",(0,o.kt)("inlineCode",{parentName:"p"},"serve.go")," file simply references it\nat the right times. The rest of our backend code is in the ",(0,o.kt)("inlineCode",{parentName:"p"},"pkg/")," folder. There\nare some, ",(0,o.kt)("em",{parentName:"p"},"small")," exceptions, but practically all backend logic should be found\nin here. ",(0,o.kt)("inlineCode",{parentName:"p"},"pkg/")," is the backend developer's home base."),(0,o.kt)("div",{className:"admonition admonition-tip alert alert--success"},(0,o.kt)("div",{parentName:"div",className:"admonition-heading"},(0,o.kt)("h5",{parentName:"div"},(0,o.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,o.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,o.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M6.5 0C3.48 0 1 2.19 1 5c0 .92.55 2.25 1 3 1.34 2.25 1.78 2.78 2 4v1h5v-1c.22-1.22.66-1.75 2-4 .45-.75 1-2.08 1-3 0-2.81-2.48-5-5.5-5zm3.64 7.48c-.25.44-.47.8-.67 1.11-.86 1.41-1.25 2.06-1.45 3.23-.02.05-.02.11-.02.17H5c0-.06 0-.13-.02-.17-.2-1.17-.59-1.83-1.45-3.23-.2-.31-.42-.67-.67-1.11C2.44 6.78 2 5.65 2 5c0-2.2 2.02-4 4.5-4 1.22 0 2.36.42 3.22 1.19C10.55 2.94 11 3.94 11 5c0 .66-.44 1.78-.86 2.48zM4 14h5c-.23 1.14-1.3 2-2.5 2s-2.27-.86-2.5-2z"}))),"Terminology")),(0,o.kt)("div",{parentName:"div",className:"admonition-content"},(0,o.kt)("p",{parentName:"div"},'A lot of concepts in the backend have shared terminology. We have the concept of an "',(0,o.kt)("strong",{parentName:"p"},"endpoint"),'," but it can be called different things depending on which part of the stack you\'re in. For example, an "endpoint" in the API YAML file actually goes under the ',(0,o.kt)("inlineCode",{parentName:"p"},"paths:"),' category. So "endpoint" = "',(0,o.kt)("strong",{parentName:"p"},"path"),'" in this context.'),(0,o.kt)("p",{parentName:"div"},"In the YAML file, we also have a property on each path called ",(0,o.kt)("inlineCode",{parentName:"p"},"operationId:"),'. This is the unique name for your endpoint, or "path." Now "endpoint" = "path" = "',(0,o.kt)("strong",{parentName:"p"},"operation"),'."'),(0,o.kt)("p",{parentName:"div"},'In the backend, we also use "',(0,o.kt)("strong",{parentName:"p"},"handler"),'" functions to execute the logic for our endpoints. You will see the terms "handler" and "endpoint" used interchangeably throughout our documentation. Keep in mind that these things all tie back to the same concept, and remember that tech terminology is unfair and wacky.'))),(0,o.kt)("h2",{id:"the-backend-pkg"},"The Backend: ",(0,o.kt)("inlineCode",{parentName:"h2"},"pkg/")),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"gen/")," - the generated Swagger code. No development happens here, but this is where any changes to the API YAML spec will be reflected"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"handlers/"),' - contains our receiving functions for all of our endpoints. We call them "handler functions." Each endpoint (or path or operation, as mentioned above) will have a distinct handler function.'),(0,o.kt)("p",null,"So how do you find the handler function for the endpoint you're looking at?"),(0,o.kt)("p",null,"Within ",(0,o.kt)("inlineCode",{parentName:"p"},"handlers/"),", each API file will have its own sub-package. So the\n",(0,o.kt)("inlineCode",{parentName:"p"},"ghc.yaml")," API file will have a package called ",(0,o.kt)("inlineCode",{parentName:"p"},"ghcapi/"),". See below:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"handlers/\n\u251c\u2500\u2500 ghcapi/\n\u251c\u2500\u2500 ...\n")),(0,o.kt)("p",null,"Now go back to your API definition in the YAML file. You should see a ",(0,o.kt)("inlineCode",{parentName:"p"},"tags:")," key. It will look like:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-yaml"},"/mto-shipments:\n  post:\n    summary: createMTOShipment\n    description: |\n      ...\n    consumes:\n      - application/json\n    produces:\n      - application/json\n    operationId: createMTOShipment\n    tags:\n      - mtoShipment\n")),(0,o.kt)("p",null,"Here we see the tag ",(0,o.kt)("inlineCode",{parentName:"p"},"mtoShipment"),". This will correspond directly with a Go file within the ",(0,o.kt)("inlineCode",{parentName:"p"},"internalapi/")," package in the backend. So now you know you're looking for the ",(0,o.kt)("inlineCode",{parentName:"p"},"mto_shipment.go")," file:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre"},"handlers/\n\u251c\u2500\u2500 ghcapi/\n\u2502   \u251c\u2500\u2500 mto_shipment.go\n\u2502   \u251c\u2500\u2500 ...\n\u251c\u2500\u2500 ...\n")),(0,o.kt)("p",null,"Back in the API definition again, this time look for the ",(0,o.kt)("inlineCode",{parentName:"p"},"operationId:")," key. If you look at the example above, you can see we have the value ",(0,o.kt)("inlineCode",{parentName:"p"},"createMTOShipment")," as our operation ID for this endpoint."),(0,o.kt)("p",null,"Within the ",(0,o.kt)("inlineCode",{parentName:"p"},"mto_shipment.go")," file, we now know we're looking for a struct called\n",(0,o.kt)("inlineCode",{parentName:"p"},"CreateMTOShipmentHandler"),". This struct will have an associated ",(0,o.kt)("inlineCode",{parentName:"p"},"Handle()"),"\nfunction. Almost all of the logic (save for authentications, and some validation\nin the generated Swagger files) for your the action your endpoint represents is\nexecuted from this function."),(0,o.kt)("p",null,'Although this function executes the logic for this endpoint\'s action, it generally calls other functions to complete the bulk of the business logic. In the MilMove codebase, we have a concept of "services." Services are shared business logic that we use across all of our APIs - see below (TODO LINK) for a more in-depth explanation.'),(0,o.kt)("p",null,"In the struct for the handler (",(0,o.kt)("inlineCode",{parentName:"p"},"CreateMTOShipmentHandler")," in this example), you'll see that some services are defined ..."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"services/"),' - contains the code for our "service objects." Service objects, or services, are utility functions that access the database. Generally, no other part of the codebase should be directly accessing the database (although there are always exceptions to any rule).'),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"models/")," - NOTE: explain the difference between models and database access. Explain the role models serve in the ORM."),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"testdatagen/")," - NOTE: kind of an aside - uses the models to make test data in test database (but could work in any DB...)"),(0,o.kt)("p",null,"The other top-level packages in the backend are for niche processes that most folks won't interact with. Your day-to-day will be in these four folders (not including ",(0,o.kt)("inlineCode",{parentName:"p"},"gen/")," since those are generated files)."),(0,o.kt)("p",null,"NOTE: Middleware... If we have a comprehensive guide, it might be:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Server/Backend Introduction",(0,o.kt)("ul",{parentName:"li"},(0,o.kt)("li",{parentName:"ul"},"Day-to-Day Overview"),(0,o.kt)("li",{parentName:"ul"},"Guide to Middleware"),(0,o.kt)("li",{parentName:"ul"},"In depth on Service Objects"),(0,o.kt)("li",{parentName:"ul"},"Models (and Database interactions?)"),(0,o.kt)("li",{parentName:"ul"},"The Pricer/Rate engine?")))),(0,o.kt)("p",null,'In docusaurus, have a "Guides" section for tutorials and the like. Point new folks here.'))}p.isMDXComponent=!0}}]);