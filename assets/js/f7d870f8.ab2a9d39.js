"use strict";(self.webpackChunkmymove_docs=self.webpackChunkmymove_docs||[]).push([[4211],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>u});var r=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},d=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},m=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=c(n),u=i,h=m["".concat(l,".").concat(u)]||m[u]||p[u]||a;return n?r.createElement(h,o(o({ref:t},d),{},{components:n})):r.createElement(h,o({ref:t},d))}));function u(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=m;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s.mdxType="string"==typeof e?e:i,o[1]=s;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}m.displayName="MDXCreateElement"},85052:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>o,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var r=n(87462),i=(n(67294),n(3905));const a={title:"0033 Service Object Layer",description:"Decision outcome: Adopt service object layer, an architectural pattern for\nwriting code that allows for encapsulation of logic, code re-usability,\nultimately keeping our handler code much less complex and more lightweight.\n"},o="*Service Object Layer*",s={unversionedId:"adrs/service-object-layer",id:"adrs/service-object-layer",title:"0033 Service Object Layer",description:"Decision outcome: Adopt service object layer, an architectural pattern for\nwriting code that allows for encapsulation of logic, code re-usability,\nultimately keeping our handler code much less complex and more lightweight.\n",source:"@site/docs/adrs/0033-service-object-layer.md",sourceDirName:"adrs",slug:"/adrs/service-object-layer",permalink:"/mymove-docs/docs/adrs/service-object-layer",draft:!1,editUrl:"https://github.com/transcom/mymove-docs/edit/main/docs/adrs/0033-service-object-layer.md",tags:[],version:"current",sidebarPosition:33,frontMatter:{title:"0033 Service Object Layer",description:"Decision outcome: Adopt service object layer, an architectural pattern for\nwriting code that allows for encapsulation of logic, code re-usability,\nultimately keeping our handler code much less complex and more lightweight.\n"},sidebar:"adrsSidebar",previous:{title:"0032 CSRF Protection for the Application",permalink:"/mymove-docs/docs/adrs/csrf-protection"},next:{title:"0034 Working With Mocks: Generation and Assertion\n",permalink:"/mymove-docs/docs/adrs/working-with-mocks-generation-and-assertion"}},l={},c=[{value:"Decision Drivers",id:"decision-drivers",level:2},{value:"Considered Options",id:"considered-options",level:2},{value:"Decision Outcome",id:"decision-outcome",level:2},{value:"Pros and Cons of the Alternatives",id:"pros-and-cons-of-the-alternatives",level:2},{value:"<em>Service Objects</em>",id:"service-objects",level:3},{value:"<em>Do Nothing</em>",id:"do-nothing",level:3}],d={toc:c};function p(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"service-object-layer"},(0,i.kt)("em",{parentName:"h1"},"Service Object Layer")),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"NOTE:")," ",(0,i.kt)("a",{parentName:"p",href:"/mymove-docs/docs/adrs/use-orchestrator-service-objects"},"ADR-0069 Use orchestrator service objects")," expands on service\nobjects when it comes to how they should interact with each other when they're closely related. While it doesn't\nsupersede this one, it may be helpful to read after reading this one."),(0,i.kt)("p",null,"Currently the web service is built as two layers, Web Handlers (",(0,i.kt)("a",{parentName:"p",href:"https://github.com/transcom/mymove/tree/master/pkg/handlers"},"pkg/handlers"),") which implement interfaces based on the swagger definitions of the services provided by the server and Model Objects (",(0,i.kt)("a",{parentName:"p",href:"https://github.com/transcom/mymove/tree/master/pkg/models"},"pkg/models"),") which marshal object representations of data in and out of the database."),(0,i.kt)("p",null,"We are currently coming across a number of issues which suggest that we have reached the limits of what such a naive, two-layer design can easily support, viz:"),(0,i.kt)("p",null,"It is not clear where Authorization code should live, i.e. code which enforces that logged in users only see and can access the data pertinent to them. Currently this is in the models (see ",(0,i.kt)("a",{parentName:"p",href:"/mymove-docs/docs/adrs/model-authorization-and-handler-design"},"ADR 0024"),") but that means that models cannot be used for tools applications with different authorization controls, e.g. bulk loaders or admin interfaces.\nFurthermore, there is no place for code which touches multiple models, but is used by more than one handler, e.g. enforcing coherent state for multiple object relating to the same move (aka 'state machines') or making sure invoices line items are consistent between the GBL and the invoice.\nThere is little or no encapsulation in the layers, so details of pop (database ORM) usage are in the handlers and equally swagger details appear in the model code. These examples and others show how painful our experiences with testing and refactoring could be."),(0,i.kt)("p",null,"Ultimately, this lead to a discussion around Business Logic and Service Layers. Jim drew the teams attention to the Service Object pattern from rails. Looking for a similar pattern for go, it was suggested that we simply implement the Service Object pattern. For further context on the pattern that inspires our approach, please see this ",(0,i.kt)("a",{parentName:"p",href:"https://medium.com/selleo/essential-rubyonrails-patterns-part-1-service-objects-1af9f9573ca1"},"article"),"."),(0,i.kt)("p",null,"This, in turn, lead to a search for a Dependency Injection framework for golang which could be used in place of the global state used in Rails. Nick T. then went on to complete a spike that investigated Dig, a dependency injection framework, resulting in a very high value, but risky ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/transcom/mymove/pull/1118"},"PR")," with over 132 different file changes. The ",(0,i.kt)("a",{parentName:"p",href:"https://docs.google.com/document/d/1xlqgVSTf9JUhZfWR18rvzaGPg2iHcF7uKRahGvrO45E/edit#"},"service object layer and dependency injection design document")," ultimately provided a plan for integration - first provide and integrate examples of service objects, provide training on using service objects, then finally adding the dependency injection framework later. This ADR is primarily concerned with the decisions behind adding a service object layer."),(0,i.kt)("h2",{id:"decision-drivers"},"Decision Drivers"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Ease of adoption"),(0,i.kt)("li",{parentName:"ul"},"Minimal impact"),(0,i.kt)("li",{parentName:"ul"},"Provide encapsulation of logic"),(0,i.kt)("li",{parentName:"ul"},"Better ability to test and refactor encapsulations of logic"),(0,i.kt)("li",{parentName:"ul"},"Code re-usability")),(0,i.kt)("h2",{id:"considered-options"},"Considered Options"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Service Objects"),(0,i.kt)("li",{parentName:"ul"},"Do nothing")),(0,i.kt)("h2",{id:"decision-outcome"},"Decision Outcome"),(0,i.kt)("p",null,"Adopt service object layer, an architectural pattern for writing code that allows for encapsulation of logic, code re-usability, ultimately keeping our handler code much less complex and more lightweight."),(0,i.kt)("p",null,"Resources:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://medium.com/selleo/essential-rubyonrails-patterns-part-1-service-objects-1af9f9573ca1"},"Essential Ruby On Rails Patterns - Part 1: Service Objects")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://www.calhoun.io/using-the-service-object-pattern-in-go/"},"Using the Service Object Pattern in Go")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://docs.google.com/document/d/1xlqgVSTf9JUhZfWR18rvzaGPg2iHcF7uKRahGvrO45E/edit#"},"Service Object Layer & Dependency Injection Design Document"))),(0,i.kt)("h2",{id:"pros-and-cons-of-the-alternatives"},"Pros and Cons of the Alternatives"),(0,i.kt)("h3",{id:"service-objects"},(0,i.kt)("em",{parentName:"h3"},"Service Objects")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Allows better organization of business logic"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Keeps API handler endpoints less complex by writing less code"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Improves maintainability as ease of refactoring is increased"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Allows better unit testing"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Allows encapsulation of logic"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Provides code re-usability"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Provides a pattern for writing better code as more conventions are introduced defining codification of services"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"+")," Provides easier scalability"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," New learning as team must adopt new pattern"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," Dependency management can become difficult as services become more complex")),(0,i.kt)("h3",{id:"do-nothing"},(0,i.kt)("em",{parentName:"h3"},"Do Nothing")),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"-")," Maintains everything as-is and we reap none of the above benefits.")))}p.isMDXComponent=!0}}]);